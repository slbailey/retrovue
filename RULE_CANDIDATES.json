{
  "RULE_CANDIDATES": [
    {
      "rule_id": "ARCH-air-Phase6-001",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6-ExecutionContract.md",
      "source_heading": "Contract",
      "source_quote": "On LoadPreview: loads asset into preview slot; shadow decode may start; does not go live.",
      "source_paraphrase": "LoadPreview loads asset into preview only; does not switch to live.",
      "component_scope": "air",
      "topic": "switching",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "LoadPreview MUST load asset into preview slot; MUST NOT go live.",
      "phase_applicability": "6",
      "observability_requirements": [],
      "testability_notes": "Assert LoadPreviewResponse.shadow_decode_started; verify no live switch."
    },
    {
      "rule_id": "ARCH-air-Phase6-002",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6-ExecutionContract.md",
      "source_heading": "Contract",
      "source_quote": "On SwitchToLive: promotes preview to live exactly when commanded (at boundary); seamless, no gap.",
      "source_paraphrase": "SwitchToLive promotes preview to live exactly when commanded; no gap.",
      "component_scope": "air",
      "topic": "switching",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "SwitchToLive MUST promote preview to live exactly when commanded; MUST be seamless with no gap.",
      "phase_applicability": "6",
      "observability_requirements": [],
      "testability_notes": "Assert SwitchToLiveResponse.pts_contiguous; assert switch at commanded time."
    },
    {
      "rule_id": "ARCH-air-Phase6-003",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6-ExecutionContract.md",
      "source_heading": "Test scaffolding — control-plane outcomes only",
      "source_quote": "Phase 6 tests must not inspect MPEG-TS bytes.",
      "source_paraphrase": "Phase 6 tests use gRPC outcomes only; no TS byte inspection.",
      "component_scope": "air",
      "topic": "logging",
      "rule_type": "test",
      "severity": "med",
      "normative_text": "Phase 6 tests MUST NOT inspect MPEG-TS bytes.",
      "phase_applicability": "6",
      "observability_requirements": [],
      "testability_notes": "Assert no TS parsing in Phase 6 test code."
    },
    {
      "rule_id": "ARCH-air-Phase6-004",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6-ExecutionContract.md",
      "source_heading": "Tests (Phase 6 — gRPC / control-plane only)",
      "source_quote": "After LoadPreview: LoadPreviewResponse.shadow_decode_started == true",
      "source_paraphrase": "LoadPreview response must indicate shadow decode started.",
      "component_scope": "air",
      "topic": "telemetry",
      "rule_type": "test",
      "severity": "high",
      "normative_text": "LoadPreviewResponse SHOULD have shadow_decode_started == true when applicable.",
      "phase_applicability": "6",
      "observability_requirements": ["LoadPreviewResponse.shadow_decode_started"],
      "testability_notes": "Assert LoadPreviewResponse.shadow_decode_started == true."
    },
    {
      "rule_id": "ARCH-air-Phase6-005",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6-ExecutionContract.md",
      "source_heading": "Tests (Phase 6 — gRPC / control-plane only)",
      "source_quote": "After SwitchToLive: SwitchToLiveResponse.pts_contiguous == true (when available)",
      "source_paraphrase": "SwitchToLive response indicates PTS continuity when implemented.",
      "component_scope": "air",
      "topic": "telemetry",
      "rule_type": "test",
      "severity": "high",
      "normative_text": "SwitchToLiveResponse SHOULD have pts_contiguous == true when implemented.",
      "phase_applicability": "6",
      "observability_requirements": ["SwitchToLiveResponse.pts_contiguous"],
      "testability_notes": "Assert SwitchToLiveResponse.pts_contiguous == true."
    },
    {
      "rule_id": "ARCH-air-Phase6-006",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6-ExecutionContract.md",
      "source_heading": "Tests (Phase 6 — gRPC / control-plane only)",
      "source_quote": "Channel remains active across multiple switches; no spurious StopChannel.",
      "source_paraphrase": "Channel stays active across switches; StopChannel only when commanded.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Channel MUST remain active across switches; MUST NOT receive spurious StopChannel.",
      "phase_applicability": "6",
      "observability_requirements": [],
      "testability_notes": "Assert no StopChannel unless explicitly commanded (e.g. last viewer disconnects)."
    },
    {
      "rule_id": "ARCH-air-Phase6-007",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6-ExecutionContract.md",
      "source_heading": "Tests (Phase 6 — gRPC / control-plane only)",
      "source_quote": "Receives LoadPreview for next segment before current segment ends",
      "source_paraphrase": "LoadPreview for next segment must occur before boundary.",
      "component_scope": "both",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "LoadPreview for next segment MUST be received before current segment ends.",
      "phase_applicability": "6",
      "observability_requirements": [],
      "testability_notes": "Assert LoadPreview call timestamp < boundary; SwitchToLive at boundary."
    },
    {
      "rule_id": "ARCH-air-Phase6A0-001",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-0-ControlSurface.md",
      "source_heading": "Contract",
      "source_quote": "Must compile and link against the generated code from protos/playout.proto.",
      "source_paraphrase": "Air must use proto-generated code.",
      "component_scope": "air",
      "topic": "other",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Air MUST compile and link against protos/playout.proto generated code.",
      "phase_applicability": "6A.0",
      "observability_requirements": [],
      "testability_notes": "Build succeeds; binary links against gRPC/proto stubs."
    },
    {
      "rule_id": "ARCH-air-Phase6A0-002",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-0-ControlSurface.md",
      "source_heading": "Contract",
      "source_quote": "Must expose PlayoutControl with StartChannel, LoadPreview, SwitchToLive, StopChannel.",
      "source_paraphrase": "Four core RPCs required on PlayoutControl.",
      "component_scope": "air",
      "topic": "other",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Air MUST expose PlayoutControl with StartChannel, LoadPreview, SwitchToLive, StopChannel.",
      "phase_applicability": "6A.0",
      "observability_requirements": [],
      "testability_notes": "Client can call all four RPCs and receive valid response."
    },
    {
      "rule_id": "ARCH-air-Phase6A0-003",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-0-ControlSurface.md",
      "source_heading": "Ordering",
      "source_quote": "StartChannel initializes channel state but does not imply media playback.",
      "source_paraphrase": "StartChannel alone does not start media; LoadPreview+SwitchToLive required.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "StartChannel MUST NOT imply media playback; media execution begins only after LoadPreview + SwitchToLive.",
      "phase_applicability": "6A.0",
      "observability_requirements": [],
      "testability_notes": "Assert StartChannel alone produces no decode/output."
    },
    {
      "rule_id": "ARCH-air-Phase6A0-004",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-0-ControlSurface.md",
      "source_heading": "Success vs error semantics (6A.0)",
      "source_quote": "StartChannel on an already-started channel → idempotent success",
      "source_paraphrase": "StartChannel idempotent when channel already started.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "StartChannel on already-started channel MUST return idempotent success.",
      "phase_applicability": "6A.0",
      "observability_requirements": [],
      "testability_notes": "Call StartChannel twice; assert both return success."
    },
    {
      "rule_id": "ARCH-air-Phase6A0-005",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-0-ControlSurface.md",
      "source_heading": "Success vs error semantics (6A.0)",
      "source_quote": "LoadPreview before StartChannel for that channel → error (success=false).",
      "source_paraphrase": "LoadPreview without prior StartChannel must fail.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "LoadPreview before StartChannel for that channel MUST return error (success=false).",
      "phase_applicability": "6A.0",
      "observability_requirements": [],
      "testability_notes": "Call LoadPreview without StartChannel; assert success=false."
    },
    {
      "rule_id": "ARCH-air-Phase6A0-006",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-0-ControlSurface.md",
      "source_heading": "Success vs error semantics (6A.0)",
      "source_quote": "SwitchToLive with no preview loaded → error (success=false).",
      "source_paraphrase": "SwitchToLive without preview must fail.",
      "component_scope": "air",
      "topic": "switching",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "SwitchToLive with no preview loaded MUST return error (success=false).",
      "phase_applicability": "6A.0",
      "observability_requirements": [],
      "testability_notes": "Call SwitchToLive without LoadPreview; assert success=false."
    },
    {
      "rule_id": "ARCH-air-Phase6A0-007",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-0-ControlSurface.md",
      "source_heading": "Success vs error semantics (6A.0)",
      "source_quote": "StopChannel on unknown or already-stopped channel → idempotent success",
      "source_paraphrase": "StopChannel idempotent for unknown or stopped channel.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "StopChannel on unknown or already-stopped channel MUST return idempotent success.",
      "phase_applicability": "6A.0",
      "observability_requirements": [],
      "testability_notes": "Call StopChannel on unknown channel; assert success."
    },
    {
      "rule_id": "ARCH-air-Phase6A0-008",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-0-ControlSurface.md",
      "source_heading": "Contract",
      "source_quote": "Air must not interpret plan_handle in 6A.0",
      "source_paraphrase": "plan_handle accepted for proto compatibility only; no behavior.",
      "component_scope": "air",
      "topic": "other",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "Air MUST NOT interpret plan_handle in 6A.0; accepted only for proto compatibility.",
      "phase_applicability": "6A.0",
      "observability_requirements": [],
      "testability_notes": "plan_handle values do not affect behavior."
    },
    {
      "rule_id": "ARCH-air-Phase6A1-001",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-1-ExecutionProducer.md",
      "source_heading": "Contract",
      "source_quote": "Engine (Air) owns preview/live slot state and switch timing; producers are passive",
      "source_paraphrase": "Engine owns slots and switch timing; producers respond only to Start/Stop.",
      "component_scope": "air",
      "topic": "producer",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Engine MUST own preview/live slot state and switch timing; producers MUST be passive.",
      "phase_applicability": "6A.1",
      "observability_requirements": [],
      "testability_notes": "Producer does not self-switch; engine controls all transitions."
    },
    {
      "rule_id": "ARCH-air-Phase6A1-002",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-1-ExecutionProducer.md",
      "source_heading": "Contract",
      "source_quote": "Producers must not self-switch or manage switch timing internally.",
      "source_paraphrase": "Producers do not control when they go live.",
      "component_scope": "air",
      "topic": "producer",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Producers MUST NOT self-switch or manage switch timing internally.",
      "phase_applicability": "6A.1",
      "observability_requirements": [],
      "testability_notes": "Producer only responds to Start/Stop; no internal switch logic."
    },
    {
      "rule_id": "ARCH-air-Phase6A1-003",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-1-ExecutionProducer.md",
      "source_heading": "Stop semantics",
      "source_quote": "On StopChannel: All producers for that channel must stop; no frames after stop.",
      "source_paraphrase": "StopChannel stops all producers; no frames after.",
      "component_scope": "air",
      "topic": "producer",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "On StopChannel, all producers MUST stop; MUST NOT emit frames after stop.",
      "phase_applicability": "6A.1",
      "observability_requirements": [],
      "testability_notes": "Assert no frames after StopChannel; resources released."
    },
    {
      "rule_id": "ARCH-air-Phase6A1-004",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-1-ExecutionProducer.md",
      "source_heading": "Stop semantics",
      "source_quote": "On segment boundary (hard_stop_time_ms): Producer must stop at or before; engine must never play past.",
      "source_paraphrase": "Producer stops at or before hard_stop_time_ms.",
      "component_scope": "air",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Producer MUST stop at or before hard_stop_time_ms; engine MUST NOT play past it.",
      "phase_applicability": "6A.1",
      "observability_requirements": [],
      "testability_notes": "Assert producer stopped by hard_stop_time_ms; stub may record param and assert."
    },
    {
      "rule_id": "ARCH-air-Phase6A1-005",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-1-ExecutionProducer.md",
      "source_heading": "Contract",
      "source_quote": "LoadPreview installs into preview slot; live unchanged until SwitchToLive.",
      "source_paraphrase": "LoadPreview updates preview only; live unchanged.",
      "component_scope": "air",
      "topic": "switching",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "LoadPreview MUST install into preview slot; live MUST remain unchanged until SwitchToLive.",
      "phase_applicability": "6A.1",
      "observability_requirements": [],
      "testability_notes": "Assert preview updated; live unchanged after LoadPreview."
    },
    {
      "rule_id": "ARCH-air-Phase6A1-006",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-1-ExecutionProducer.md",
      "source_heading": "Tests",
      "source_quote": "SwitchToLive promotes preview to live; old live is stopped (or recycled); preview cleared.",
      "source_paraphrase": "SwitchToLive swaps preview to live; old live stopped; preview cleared.",
      "component_scope": "air",
      "topic": "switching",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "SwitchToLive MUST promote preview to live; old live MUST be stopped; preview slot cleared or ready for next.",
      "phase_applicability": "6A.1",
      "observability_requirements": [],
      "testability_notes": "Assert old live stopped; preview slot cleared; ready for next LoadPreview."
    },
    {
      "rule_id": "ARCH-air-Phase6A2-001",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-2-FileBackedProducer.md",
      "source_heading": "Contract",
      "source_quote": "Honor start_offset_ms and hard_stop_time_ms.",
      "source_paraphrase": "FileBackedProducer must respect segment params.",
      "component_scope": "air",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "FileBackedProducer MUST honor start_offset_ms and hard_stop_time_ms.",
      "phase_applicability": "6A.2",
      "observability_requirements": [],
      "testability_notes": "Assert output respects start and stop; duration or wall-clock check."
    },
    {
      "rule_id": "ARCH-air-Phase6A2-002",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-2-FileBackedProducer.md",
      "source_heading": "Seek",
      "source_quote": "Seek to position at or before start_offset_ms; no playback earlier than intended.",
      "source_paraphrase": "Seek at or before start_offset_ms; never start earlier than intended.",
      "component_scope": "air",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Decode MUST seek to position at or before start_offset_ms; MUST NOT play earlier than intended.",
      "phase_applicability": "6A.2",
      "observability_requirements": [],
      "testability_notes": "Validate seek by reported timestamps within tolerance; not earlier than start_offset_ms."
    },
    {
      "rule_id": "ARCH-air-Phase6A2-003",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-2-FileBackedProducer.md",
      "source_heading": "Stop",
      "source_quote": "Stops at or before hard_stop_time_ms; never exceed hard stop.",
      "source_paraphrase": "Producer never plays past hard stop.",
      "component_scope": "air",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Producer MUST stop at or before hard_stop_time_ms; MUST NOT play past it.",
      "phase_applicability": "6A.2",
      "observability_requirements": [],
      "testability_notes": "Assert no frames/bytes after hard_stop_time_ms."
    },
    {
      "rule_id": "ARCH-air-Phase6A2-004",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-2-FileBackedProducer.md",
      "source_heading": "Tests",
      "source_quote": "Invalid path or unreadable file yields defined error (e.g. LoadPreviewResponse.success=false).",
      "source_paraphrase": "Invalid asset path must return defined error.",
      "component_scope": "air",
      "topic": "other",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Invalid path or unreadable file MUST yield defined error (success=false or equivalent).",
      "phase_applicability": "6A.2",
      "observability_requirements": [],
      "testability_notes": "Assert LoadPreviewResponse.success=false for invalid path."
    },
    {
      "rule_id": "ARCH-air-Phase6A2-005",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-2-FileBackedProducer.md",
      "source_heading": "Tests",
      "source_quote": "StopChannel (or segment stop) causes producer to stop and release resources; no orphan ffmpeg processes.",
      "source_paraphrase": "Stop must release resources; no orphan processes.",
      "component_scope": "air",
      "topic": "producer",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "StopChannel or segment stop MUST release resources; MUST NOT leave orphan ffmpeg processes.",
      "phase_applicability": "6A.2",
      "observability_requirements": [],
      "testability_notes": "Assert no orphan ffmpeg after stop."
    },
    {
      "rule_id": "ARCH-air-Phase6A3-001",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-3-ProgrammaticProducer.md",
      "source_heading": "Contract",
      "source_quote": "No decode: Does not read files or call ffmpeg.",
      "source_paraphrase": "ProgrammaticProducer generates synthetic frames only.",
      "component_scope": "air",
      "topic": "producer",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "ProgrammaticProducer MUST NOT read files or call ffmpeg.",
      "phase_applicability": "6A.3",
      "observability_requirements": [],
      "testability_notes": "Assert no ffmpeg invocation for programmatic path."
    },
    {
      "rule_id": "ARCH-air-Phase6A3-002",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-3-ProgrammaticProducer.md",
      "source_heading": "Contract",
      "source_quote": "Same interface: Fits ExecutionProducer lifecycle (Start/Stop) and slot model.",
      "source_paraphrase": "ProgrammaticProducer uses same lifecycle as ExecutionProducer.",
      "component_scope": "air",
      "topic": "producer",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "ProgrammaticProducer MUST fit ExecutionProducer lifecycle and preview/live slot model.",
      "phase_applicability": "6A.3",
      "observability_requirements": [],
      "testability_notes": "Assert LoadPreview + SwitchToLive works with programmatic producer."
    },
    {
      "rule_id": "ARCH-air-Phase6A3-003",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-3-ProgrammaticProducer.md",
      "source_heading": "Tests",
      "source_quote": "Stop at hard_stop_time_ms (or StopChannel) stops the programmatic producer; no frames after stop.",
      "source_paraphrase": "ProgrammaticProducer honors hard stop and StopChannel.",
      "component_scope": "air",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "ProgrammaticProducer MUST stop at hard_stop_time_ms or StopChannel; MUST NOT emit frames after stop.",
      "phase_applicability": "6A.3",
      "observability_requirements": [],
      "testability_notes": "Assert no frames after hard stop or StopChannel."
    },
    {
      "rule_id": "ARCH-air-Phase6AOverview-001",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-Overview.md",
      "source_heading": "Cross-phase invariants",
      "source_quote": "No schedule or plan logic in Air: Air must not interpret schedules or plans.",
      "source_paraphrase": "Air does not interpret schedules; receives exact execution instructions.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Air MUST NOT interpret schedules or plans; segment-based control is canonical.",
      "phase_applicability": "6A",
      "observability_requirements": [],
      "testability_notes": "Plan handles accepted for proto only; no schedule-driven behavior."
    },
    {
      "rule_id": "ARCH-air-Phase6AOverview-002",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-Overview.md",
      "source_heading": "Cross-phase invariants",
      "source_quote": "Segment-based control: Media execution driven by LoadPreview (segment payload) then SwitchToLive.",
      "source_paraphrase": "Execution driven by LoadPreview then SwitchToLive at boundary.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Media execution MUST be driven by LoadPreview then SwitchToLive (at boundary).",
      "phase_applicability": "6A",
      "observability_requirements": [],
      "testability_notes": "Assert LoadPreview precedes SwitchToLive; SwitchToLive at boundary."
    },
    {
      "rule_id": "ARCH-air-Phase6AOverview-003",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-Overview.md",
      "source_heading": "Cross-phase invariants",
      "source_quote": "Clock authority: MasterClock lives in the Python runtime. Air enforces deadlines.",
      "source_paraphrase": "MasterClock in Core; Air enforces deadlines, does not compute schedule time.",
      "component_scope": "both",
      "topic": "clock",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "MasterClock lives in Core; Air MUST enforce deadlines but MUST NOT compute schedule time.",
      "phase_applicability": "6A",
      "observability_requirements": [],
      "testability_notes": "Air uses injected/remote clock for deadlines; no schedule computation."
    },
    {
      "rule_id": "ARCH-air-Phase6AOverview-004",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-Overview.md",
      "source_heading": "Cross-phase invariants",
      "source_quote": "Hard stop authoritative: hard_stop_time_ms is authoritative; Air may stop at or before, never past.",
      "source_paraphrase": "hard_stop_time_ms authoritative; never play past.",
      "component_scope": "air",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "hard_stop_time_ms is authoritative; Air MAY stop at or before; MUST NOT play past it.",
      "phase_applicability": "6A",
      "observability_requirements": [],
      "testability_notes": "Assert no output after hard_stop_time_ms."
    },
    {
      "rule_id": "ARCH-air-Phase6AOverview-005",
      "source_repo": "air",
      "source_path": "pkg/air/docs/archive/phases/Phase6A-Overview.md",
      "source_heading": "Cross-phase invariants",
      "source_quote": "Heterogeneous producers: Engine supports both file-backed and programmatic producers.",
      "source_paraphrase": "Same lifecycle and slot model for file-backed and programmatic.",
      "component_scope": "air",
      "topic": "producer",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "Engine MUST support both file-backed and programmatic producers with same ExecutionProducer lifecycle.",
      "phase_applicability": "6A",
      "observability_requirements": [],
      "testability_notes": "Assert alternation FileBackedSegment → ProgrammaticSegment works."
    },
    {
      "rule_id": "ARCH-core-Phase0Clock-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-ClockContract.md",
      "source_heading": "Contract",
      "source_quote": "MasterClock (or equivalent) is the single time authority.",
      "source_paraphrase": "Single testable time authority for all downstream.",
      "component_scope": "core",
      "topic": "clock",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "MasterClock MUST be the single time authority.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "All time consumed via MasterClock.now() or equivalent."
    },
    {
      "rule_id": "ARCH-core-Phase0Clock-002",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-ClockContract.md",
      "source_heading": "Contract",
      "source_quote": "All downstream logic consumes time only via this interface.",
      "source_paraphrase": "No raw datetime.now() or time.time() for scheduling/playout.",
      "component_scope": "core",
      "topic": "clock",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "All downstream logic MUST consume time only via MasterClock interface.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "No datetime.now() or time.time() in scheduling, grid, or playout paths."
    },
    {
      "rule_id": "ARCH-core-Phase0Clock-003",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-ClockContract.md",
      "source_heading": "Contract",
      "source_quote": "No component calls datetime.now() or time.time() directly for scheduling/playout decisions.",
      "source_paraphrase": "Explicit prohibition on raw time calls.",
      "component_scope": "core",
      "topic": "clock",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Components MUST NOT call datetime.now() or time.time() directly for scheduling/playout decisions.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "Static check or search: no direct datetime.now() in scheduling/playout."
    },
    {
      "rule_id": "ARCH-core-Phase0Playout-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-PlayoutRules.md",
      "source_heading": "Non-Negotiable Rules",
      "source_quote": "Never chain episodes back-to-back.",
      "source_paraphrase": "Episodes separated by filler; no direct episode-to-episode.",
      "component_scope": "core",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "MUST NOT chain episodes back-to-back.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "Assert playlog has filler between episodes."
    },
    {
      "rule_id": "ARCH-core-Phase0Playout-002",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-PlayoutRules.md",
      "source_heading": "Non-Negotiable Rules",
      "source_quote": "Never let content drift off the grid.",
      "source_paraphrase": "Content must snap to grid; no drift.",
      "component_scope": "core",
      "topic": "timeline",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "MUST NOT let content drift off the grid.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "Assert all segment boundaries align to grid."
    },
    {
      "rule_id": "ARCH-core-Phase0Playout-003",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-PlayoutRules.md",
      "source_heading": "Non-Negotiable Rules",
      "source_quote": "Always cut at grid boundaries.",
      "source_paraphrase": "Segments end at grid boundaries.",
      "component_scope": "core",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "MUST always cut at grid boundaries.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "Assert cuts occur at :00 or :30."
    },
    {
      "rule_id": "ARCH-core-Phase0Playout-004",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-PlayoutRules.md",
      "source_heading": "Filler as a Continuous Virtual Stream",
      "source_quote": "Never restart filler from 00:00 each time.",
      "source_paraphrase": "Filler uses continuous offset, not restart.",
      "component_scope": "core",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "MUST NOT restart filler from 00:00 each time; use filler_offset = (master_clock - filler_epoch) % filler_duration.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "Assert filler seek position uses modulo formula."
    },
    {
      "rule_id": "ARCH-core-Phase0Playout-005",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-PlayoutRules.md",
      "source_heading": "Filler as a Continuous Virtual Stream",
      "source_quote": "Never let filler overrun the grid.",
      "source_paraphrase": "Filler stops at next grid boundary.",
      "component_scope": "core",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "MUST NOT let filler overrun the grid; hard stop at next grid boundary.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "Assert filler segment ends at boundary."
    },
    {
      "rule_id": "ARCH-core-Phase0Playout-006",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase0-PlayoutRules.md",
      "source_heading": "Filler as a Continuous Virtual Stream",
      "source_quote": "Play exactly for the padding duration; Hard stop at the next grid boundary.",
      "source_paraphrase": "Filler plays exactly pad_len; hard stop at boundary.",
      "component_scope": "core",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Filler MUST play exactly for padding duration; MUST hard stop at next grid boundary.",
      "phase_applicability": "0",
      "observability_requirements": [],
      "testability_notes": "Assert filler duration equals pad_len; stop at boundary."
    },
    {
      "rule_id": "ARCH-core-Phase1Grid-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase1-GridContract.md",
      "source_heading": "Contract",
      "source_quote": "Grid size = 30 minutes; Boundaries at :00 and :30.",
      "source_paraphrase": "Fixed 30-minute grid; :00 and :30 boundaries.",
      "component_scope": "core",
      "topic": "timeline",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Grid size MUST be 30 minutes; boundaries MUST be at :00 and :30.",
      "phase_applicability": "1",
      "observability_requirements": [],
      "testability_notes": "Assert grid_start(10:00)=10:00, grid_end=10:30; 10:30 starts new grid."
    },
    {
      "rule_id": "ARCH-core-Phase2Plan-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase2-SchedulePlanContract.md",
      "source_heading": "Contract",
      "source_quote": "Each grid has exactly two items in order: A (samplecontent), B (filler).",
      "source_paraphrase": "Mock plan: two items per grid, A then B.",
      "component_scope": "core",
      "topic": "epg",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "Mock SchedulePlan MUST have exactly two items per grid in order: A (samplecontent), B (filler).",
      "phase_applicability": "2",
      "observability_requirements": [],
      "testability_notes": "Assert each grid has two items in correct order."
    },
    {
      "rule_id": "ARCH-core-Phase2Plan-002",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase2-SchedulePlanContract.md",
      "source_heading": "Contract",
      "source_quote": "Order only; no durations, no offsets, no timing in the plan itself.",
      "source_paraphrase": "SchedulePlan is duration-free; structural only.",
      "component_scope": "core",
      "topic": "epg",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "SchedulePlan MUST be duration-free; no duration or timing fields in plan.",
      "phase_applicability": "2",
      "observability_requirements": [],
      "testability_notes": "Assert plan has no duration/offset/timing fields."
    },
    {
      "rule_id": "ARCH-core-Phase2_5Asset-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase2.5-AssetMetadataContract.md",
      "source_heading": "Duration rules (hard requirements)",
      "source_quote": "duration_ms is authoritative; Measured once (e.g. ffprobe); Rounded down to integer ms.",
      "source_paraphrase": "Asset duration is authoritative, measured once, rounded down.",
      "component_scope": "core",
      "topic": "other",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "duration_ms MUST be authoritative; measured once; rounded down to integer milliseconds.",
      "phase_applicability": "2.5",
      "observability_requirements": [],
      "testability_notes": "Assert duration_ms is int; > 0; not recomputed at runtime."
    },
    {
      "rule_id": "ARCH-core-Phase2_5Asset-002",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase2.5-AssetMetadataContract.md",
      "source_heading": "Duration rules (hard requirements)",
      "source_quote": "Never recomputed in runtime logic; Never inferred from offsets or schedules.",
      "source_paraphrase": "Duration not recomputed or inferred at runtime.",
      "component_scope": "core",
      "topic": "other",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "duration_ms MUST NOT be recomputed in runtime logic; MUST NOT be inferred from offsets or schedules.",
      "phase_applicability": "2.5",
      "observability_requirements": [],
      "testability_notes": "Assert Phase 3/4 use asset.duration_ms; no probing at runtime."
    },
    {
      "rule_id": "ARCH-core-Phase2_5Asset-003",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase2.5-AssetMetadataContract.md",
      "source_heading": "Asset (explicit contract)",
      "source_quote": "Asset objects are immutable.",
      "source_paraphrase": "Asset is frozen/immutable dataclass.",
      "component_scope": "core",
      "topic": "other",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "Asset objects MUST be immutable.",
      "phase_applicability": "2.5",
      "observability_requirements": [],
      "testability_notes": "Assert Asset is frozen; no mutation."
    },
    {
      "rule_id": "ARCH-core-Phase3Resolver-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase3-ActiveItemResolverContract.md",
      "source_heading": "Mock duration config",
      "source_quote": "Resolver must assert grid_duration_ms == Phase 1 grid_duration; mismatch is configuration error.",
      "source_paraphrase": "Grid consistency: resolver fails fast if grid duration mismatch.",
      "component_scope": "core",
      "topic": "timeline",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Resolver MUST assert grid_duration_ms == Phase 1 grid_duration; mismatch MUST be configuration error (fail fast).",
      "phase_applicability": "3",
      "observability_requirements": [],
      "testability_notes": "Mismatch causes fail fast; no silent drift."
    },
    {
      "rule_id": "ARCH-core-Phase3Resolver-002",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase3-ActiveItemResolverContract.md",
      "source_heading": "Contract",
      "source_quote": "elapsed_in_grid_ms < filler_start_ms → samplecontent; elapsed_in_grid_ms >= filler_start_ms → filler.",
      "source_paraphrase": "Boundary rule: >= filler_start_ms means filler.",
      "component_scope": "core",
      "topic": "epg",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "elapsed_in_grid_ms < filler_start_ms → samplecontent; elapsed_in_grid_ms >= filler_start_ms → filler.",
      "phase_applicability": "3",
      "observability_requirements": [],
      "testability_notes": "Assert 1_498_000 → samplecontent; 1_499_000 → filler."
    },
    {
      "rule_id": "ARCH-core-Phase4Pipeline-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase4-PlayoutPipelineContract.md",
      "source_heading": "PlayoutSegment (explicit)",
      "source_quote": "hard_stop_time is authoritative when present; end_offset is advisory only.",
      "source_paraphrase": "Stopping precedence: hard_stop_time overrides end_offset.",
      "component_scope": "both",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "When hard_stop_time_ms present, it is authoritative; end_offset is advisory only and MAY be ignored.",
      "phase_applicability": "4",
      "observability_requirements": [],
      "testability_notes": "Air stops by hard_stop_time; end_offset never overrides."
    },
    {
      "rule_id": "ARCH-core-Phase4Pipeline-002",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase4-PlayoutPipelineContract.md",
      "source_heading": "PlayoutSegment (explicit)",
      "source_quote": "start_offset_ms is media-relative only, never wall-clock-relative.",
      "source_paraphrase": "start_offset_ms is media-relative; Air seeks by offset.",
      "component_scope": "both",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "start_offset_ms MUST be media-relative only; MUST NOT be wall-clock-relative.",
      "phase_applicability": "4",
      "observability_requirements": [],
      "testability_notes": "Assert start_offset_ms in segment is media position; not wall time."
    },
    {
      "rule_id": "ARCH-core-Phase4Pipeline-003",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase4-PlayoutPipelineContract.md",
      "source_heading": "Air stopping rule (contractual)",
      "source_quote": "Air may stop at or before hard_stop_time_ms, but must never play past it.",
      "source_paraphrase": "Air never plays past hard stop.",
      "component_scope": "air",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Air MAY stop at or before hard_stop_time_ms; MUST NOT play past it.",
      "phase_applicability": "4",
      "observability_requirements": [],
      "testability_notes": "Assert no output after hard_stop_time_ms."
    },
    {
      "rule_id": "ARCH-core-Phase4Pipeline-004",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase4-PlayoutPipelineContract.md",
      "source_heading": "Tests",
      "source_quote": "Every invocation creates a new instance (no reuse/mutation).",
      "source_paraphrase": "PlayoutSegment/Request is disposable; no mutating shared state.",
      "component_scope": "core",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Every invocation MUST create new segment/request; MUST NOT mutate shared state.",
      "phase_applicability": "4",
      "observability_requirements": [],
      "testability_notes": "Assert each call returns new instance; no reuse."
    },
    {
      "rule_id": "ARCH-core-Phase5CM-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase5-ChannelManagerContract.md",
      "source_heading": "Prefeed window (explicit contract)",
      "source_quote": "CM must issue LoadPreview for the next segment no later than hard_stop_time_ms - prefeed_window_ms.",
      "source_paraphrase": "LoadPreview by prefeed deadline.",
      "component_scope": "core",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "ChannelManager MUST issue LoadPreview for next segment no later than hard_stop_time_ms - prefeed_window_ms.",
      "phase_applicability": "5",
      "observability_requirements": [],
      "testability_notes": "Assert LoadPreview timestamp <= hard_stop_time_ms - prefeed_window_ms."
    },
    {
      "rule_id": "ARCH-core-Phase5CM-002",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase5-ChannelManagerContract.md",
      "source_heading": "Contract",
      "source_quote": "Issues SwitchToLive at the boundary exactly as defined in the proto.",
      "source_paraphrase": "SwitchToLive at boundary.",
      "component_scope": "core",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "ChannelManager MUST issue SwitchToLive at the boundary (after LoadPreview for that segment).",
      "phase_applicability": "5",
      "observability_requirements": [],
      "testability_notes": "Assert SwitchToLive at boundary; after LoadPreview."
    },
    {
      "rule_id": "ARCH-core-Phase5CM-003",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase5-ChannelManagerContract.md",
      "source_heading": "Contract",
      "source_quote": "Immutability: Once issued to Air, PlayoutSegment is immutable; changes require new segment and LoadPreview.",
      "source_paraphrase": "PlayoutSegment immutable once issued; no mutation.",
      "component_scope": "core",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "PlayoutSegment MUST be immutable once issued to Air; changes MUST require new segment and new LoadPreview.",
      "phase_applicability": "5",
      "observability_requirements": [],
      "testability_notes": "Assert CM never mutates issued segment; new intent = new LoadPreview."
    },
    {
      "rule_id": "ARCH-core-Phase5CM-004",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase5-ChannelManagerContract.md",
      "source_heading": "Contract",
      "source_quote": "Does not wait for Air to ask for the next segment; CM drives the timeline.",
      "source_paraphrase": "CM is proactive; drives timeline.",
      "component_scope": "core",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "ChannelManager MUST NOT wait for Air to ask for next segment; CM MUST drive the timeline.",
      "phase_applicability": "5",
      "observability_requirements": [],
      "testability_notes": "Assert CM issues LoadPreview proactively; not in response to Air request."
    },
    {
      "rule_id": "ARCH-core-Phase5CM-005",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase5-ChannelManagerContract.md",
      "source_heading": "Contract",
      "source_quote": "Must not issue duplicate LoadPreview for the same next segment when re-evaluating.",
      "source_paraphrase": "Idempotent prefeed per segment; no duplicate LoadPreview.",
      "component_scope": "core",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "ChannelManager MUST NOT issue duplicate LoadPreview for the same next segment when re-evaluating multiple times before boundary.",
      "phase_applicability": "5",
      "observability_requirements": [],
      "testability_notes": "Assert at most one LoadPreview per next segment before boundary."
    },
    {
      "rule_id": "ARCH-core-Phase7E2E-001",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase7-E2EAcceptanceContract.md",
      "source_heading": "Purpose",
      "source_quote": "Phase 7 is the only HTTP- and real-playout-dependent phase.",
      "source_paraphrase": "HTTP tune-in and real ffmpeg only in Phase 7.",
      "component_scope": "both",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "med",
      "normative_text": "Phase 7 MUST be the only phase requiring HTTP tune-in, real ffmpeg, and long-running behaviour.",
      "phase_applicability": "7",
      "observability_requirements": [],
      "testability_notes": "Phases 0-6 use direct API; Phase 7 uses GET /channel/{id}.ts."
    },
    {
      "rule_id": "ARCH-core-Phase7E2E-002",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase7-E2EAcceptanceContract.md",
      "source_heading": "Contract",
      "source_quote": "Boundaries: Grid boundaries (:00, :30) are respected forever (no early/late switch, no gap).",
      "source_paraphrase": "Grid boundaries respected; no gap.",
      "component_scope": "both",
      "topic": "segment",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Grid boundaries (:00, :30) MUST be respected forever; no early/late switch, no gap.",
      "phase_applicability": "7",
      "observability_requirements": [],
      "testability_notes": "Assert boundaries correct across multiple switches."
    },
    {
      "rule_id": "ARCH-core-Phase7E2E-003",
      "source_repo": "core",
      "source_path": "pkg/core/docs/archive/phases/Phase7-E2EAcceptanceContract.md",
      "source_heading": "Contract",
      "source_quote": "Stability: No drift after hours.",
      "source_paraphrase": "No schedule drift over long run.",
      "component_scope": "both",
      "topic": "timeline",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "MUST NOT drift after hours; offsets and hard stops remain correct.",
      "phase_applicability": "7",
      "observability_requirements": [],
      "testability_notes": "Run N × 30 min; assert offsets and hard stops correct."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK010",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-010: Lifecycle Management",
      "source_quote": "Sink supports clean start, stop, and teardown.",
      "source_paraphrase": "Sink lifecycle: start, stop, teardown; idempotent.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Sink MUST support clean start, stop, and teardown; Start returns false if already running; Stop idempotent.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "test_sink_lifecycle; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK011",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-011: Frame Consumption",
      "source_quote": "Frames consumed in FIFO order; PTS values increase monotonically.",
      "source_paraphrase": "FIFO consumption; PTS monotonic.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Frames MUST be consumed in FIFO order; PTS MUST increase monotonically in output; no reordering.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "test_sink_frame_order; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK012",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-012: MasterClock Timing",
      "source_quote": "Output timing follows MasterClock; Frames output when frame.pts <= current_time.",
      "source_paraphrase": "Sink uses MasterClock; holds future PTS; drops late frames.",
      "component_scope": "air",
      "topic": "clock",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Output timing MUST follow MasterClock; frames MUST output when frame.pts <= current_time; future PTS held; late frames dropped.",
      "phase_applicability": "7+",
      "observability_requirements": ["late_frames", "frames_dropped"],
      "testability_notes": "test_sink_timing; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK013",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-013: H.264 Encoding",
      "source_quote": "Output is valid H.264 encoded video.",
      "source_paraphrase": "Valid H.264; SPS/PPS for IDR; bitrate within 10%.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Output MUST be valid H.264 bitstream; SPS/PPS for IDR frames; bitrate within 10% of configured.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "test_sink_encoding; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK014",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-014: MPEG-TS Muxing",
      "source_quote": "All packets 188 bytes with 0x47 sync; PTS/DTS monotonically increasing.",
      "source_paraphrase": "MPEG-TS compliant: 188 bytes, 0x47, PCR 20-100ms, DTS <= PTS.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Packets MUST be 188 bytes with 0x47 sync; PTS/DTS monotonically increasing; PCR 20-100ms; DTS <= PTS.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "test_sink_encoding; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK015",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-015: Network Streaming",
      "source_quote": "Stream delivered over TCP; Non-blocking writes; Graceful disconnect handling.",
      "source_paraphrase": "TCP streaming; non-blocking; graceful disconnect.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Stream MUST be delivered over TCP; non-blocking writes; graceful disconnect handling.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "test_sink_streaming; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK020",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-020: Empty Buffer Handling",
      "source_quote": "buffer_empty_count increments; Sink backs off; Resumes when frames available.",
      "source_paraphrase": "Empty buffer: backoff, no spin, resume when available.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Empty buffer MUST increment buffer_empty_count; sink MUST back off (no spin); MUST resume when frames available.",
      "phase_applicability": "7+",
      "observability_requirements": ["buffer_empty_count", "sink_buffer_empty_total"],
      "testability_notes": "test_sink_buffer_handling; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK021",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-021: Late Frame Handling",
      "source_quote": "Late frames are dropped; late_frames and frames_dropped increment.",
      "source_paraphrase": "Late frames dropped; counters increment.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Frames beyond threshold MUST be dropped; late_frames and frames_dropped MUST increment.",
      "phase_applicability": "7+",
      "observability_requirements": ["late_frames", "frames_dropped", "sink_late_frames_total", "sink_frames_dropped_total"],
      "testability_notes": "test_sink_buffer_handling; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK022",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-022: Backpressure Handling",
      "source_quote": "Network backpressure: packets queued; queue bounded; no deadlock or crash.",
      "source_paraphrase": "Backpressure: queue bounded; no deadlock.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Backpressure MUST be handled gracefully; queue bounded; older packets dropped on overflow; no deadlock or crash.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "test_sink_network_handling; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK023",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-023: Client Disconnect Handling",
      "source_quote": "Disconnect detected; Resources cleaned up; Reconnection works normally.",
      "source_paraphrase": "Disconnect: detect, cleanup, ready for reconnect.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Client disconnect MUST be detected; resources cleaned up; sink continues waiting; reconnection MUST work normally.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "test_sink_network_handling; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK030",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-030: Error Recovery",
      "source_quote": "Recoverable errors do not stop sink; logged, counters updated, operation continues.",
      "source_paraphrase": "Recoverable errors: log, increment counters, continue.",
      "component_scope": "air",
      "topic": "logging",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Recoverable errors MUST be logged; counters updated; operation MUST continue.",
      "phase_applicability": "7+",
      "observability_requirements": ["sink_encoding_errors_total", "sink_network_errors_total"],
      "testability_notes": "test_sink_error_handling; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-SINK031",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "SINK-031: Fault Latching",
      "source_quote": "Faults are latched until explicit reset; No auto-recovery from faults.",
      "source_paraphrase": "Fault state persists until reset.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Fault state MUST persist until explicit reset; MUST NOT auto-recover from faults.",
      "phase_applicability": "7+",
      "observability_requirements": ["sink_status"],
      "testability_notes": "test_sink_error_handling; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSDomain-Telemetry",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkDomainContract.md",
      "source_heading": "Telemetry",
      "source_quote": "sink_frames_sent_total, sink_frames_dropped_total, sink_late_frames_total, etc.",
      "source_paraphrase": "Telemetry metrics required for sink observability.",
      "component_scope": "air",
      "topic": "telemetry",
      "rule_type": "metric",
      "severity": "med",
      "normative_text": "Sink SHOULD export sink_frames_sent_total, sink_frames_dropped_total, sink_late_frames_total, sink_encoding_errors_total, sink_network_errors_total, sink_buffer_empty_total, sink_running, sink_status.",
      "phase_applicability": "7+",
      "observability_requirements": ["sink_frames_sent_total", "sink_frames_dropped_total", "sink_late_frames_total", "sink_encoding_errors_total", "sink_network_errors_total", "sink_buffer_empty_total", "sink_running", "sink_status"],
      "testability_notes": "Assert metrics exported; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSTiming-T001",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkTimingContract.md",
      "source_heading": "T-001: MasterClock Authority",
      "source_quote": "Sink uses MasterClock as sole time source.",
      "source_paraphrase": "No direct system clock; all timing from MasterClock.",
      "component_scope": "air",
      "topic": "clock",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Sink MUST use MasterClock as sole time source; no direct system clock usage.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "Inject fake MasterClock; verify sink follows it; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSTiming-T002",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkTimingContract.md",
      "source_heading": "T-002: PTS to Station Time Mapping",
      "source_quote": "First frame anchors PTS zero to current MasterClock time; PTS monotonically increasing.",
      "source_paraphrase": "PTS anchored to station time; monotonic.",
      "component_scope": "air",
      "topic": "timeline",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "First frame MUST anchor PTS zero to current MasterClock; subsequent PTS MUST be monotonically increasing.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "Feed known PTS; verify output times match; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSTiming-T003",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkTimingContract.md",
      "source_heading": "T-003: On-Time and Early Frame Handling",
      "source_quote": "Frames held until scheduled time; No frames output ahead of schedule.",
      "source_paraphrase": "Future PTS causes wait; no early output.",
      "component_scope": "air",
      "topic": "clock",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Frame with future PTS MUST cause wait until scheduled time; MUST NOT output ahead of schedule.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "Verify frame output time equals target ±1ms; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSTiming-T004",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkTimingContract.md",
      "source_heading": "T-004: Underrun Handling",
      "source_quote": "buffer_underruns counter increments; Sink backs off briefly (2-5ms); No infinite loops or high CPU spin.",
      "source_paraphrase": "Empty buffer: backoff, counter, no spin.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Empty buffer MUST increment buffer_underruns; sink MUST back off 2-5ms; MUST NOT spin or high CPU.",
      "phase_applicability": "7+",
      "observability_requirements": ["buffer_underruns"],
      "testability_notes": "Start with empty buffer; verify counter and worker alive; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSTiming-T005",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkTimingContract.md",
      "source_heading": "T-005: Late Frame Detection and Drops",
      "source_quote": "Frames beyond threshold dropped; late_frame_drops counter increments.",
      "source_paraphrase": "Late frames dropped; counter increments.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Frames beyond late threshold MUST be dropped; late_frame_drops MUST increment.",
      "phase_applicability": "7+",
      "observability_requirements": ["late_frame_drops"],
      "testability_notes": "Advance clock past deadline; verify drop and counter; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSTiming-T006",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkTimingContract.md",
      "source_heading": "T-006: Monotonic Output Order",
      "source_quote": "Frames never output out of PTS order; order preserved even with drops.",
      "source_paraphrase": "Output PTS strictly increasing.",
      "component_scope": "air",
      "topic": "ts",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Frames MUST NEVER be output out of PTS order; output PTS MUST be strictly increasing.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "Record output PTS; verify strictly increasing; harness missing."
    },
    {
      "rule_id": "ARCH-main-MpegTSTiming-T007",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/MpegTSPlayoutSinkTimingContract.md",
      "source_heading": "T-007: Graceful Stop",
      "source_quote": "Stop exits timing loop within 100ms of stop request; No frames output after stop.",
      "source_paraphrase": "Stop bounded; no output after stop.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Stop MUST exit timing loop within 100ms; MUST NOT output frames after stop.",
      "phase_applicability": "7+",
      "observability_requirements": [],
      "testability_notes": "Call stop; verify thread joins within timeout; harness missing."
    },
    {
      "rule_id": "ARCH-main-Orch-ORCH001",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/OrchestrationLoopDomainContract.md",
      "source_heading": "ORCH_001: Tick Discipline & Latency Budget",
      "source_quote": "Tick skew within ±1ms for 99% of ticks; latency p95 ≤ 33ms; missed callback triggers catch-up.",
      "source_paraphrase": "Tick discipline; latency budget 33ms p95; catch-up on missed callback.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Tick skew MUST remain within ±1ms for 99% of ticks; producer→renderer latency p95 MUST be ≤ 33ms; missed MasterClock callback MUST trigger immediate catch-up tick.",
      "phase_applicability": "7+",
      "observability_requirements": ["orchestration_tick_skew_ms", "orchestration_latency_ms", "orchestration_tick_violation_total"],
      "testability_notes": "Drive ticks 5 min with jitter; assert skew and latency; harness missing."
    },
    {
      "rule_id": "ARCH-main-Orch-ORCH002",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/OrchestrationLoopDomainContract.md",
      "source_heading": "ORCH_002: Back-Pressure Handling",
      "source_quote": "Underrun/overrun resolve within three ticks; recovery time ≤ 100ms.",
      "source_paraphrase": "Back-pressure recovers in ≤3 ticks, ≤100ms.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "high",
      "normative_text": "Underrun MUST transition to buffering and restore within ≤3 ticks; overrun MUST drain within ≤3 ticks; recovery time MUST be ≤ 100ms.",
      "phase_applicability": "7+",
      "observability_requirements": ["orchestration_backpressure_events_total", "orchestration_backpressure_recovery_ms", "orchestration_backpressure_unresolved"],
      "testability_notes": "Force underrun then overrun; assert recovery; harness missing."
    },
    {
      "rule_id": "ARCH-main-Orch-ORCH003",
      "source_repo": "main",
      "source_path": "docs/legacy/air/contracts/OrchestrationLoopDomainContract.md",
      "source_heading": "ORCH_003: Starvation & Teardown Safety",
      "source_quote": "Starvation detected within ≤100ms; Teardown duration ≤ 500ms.",
      "source_paraphrase": "Starvation detection; bounded teardown.",
      "component_scope": "air",
      "topic": "orchestration",
      "rule_type": "contract",
      "severity": "critical",
      "normative_text": "Starvation MUST be detected within ≤100ms; teardown MUST complete within ≤500ms.",
      "phase_applicability": "7+",
      "observability_requirements": ["orchestration_starvation_alert_total", "orchestration_teardown_duration_ms", "orchestration_teardown_violation"],
      "testability_notes": "Block 150ms; issue Stop; assert detection and teardown; harness missing."
    }
  ]
}
