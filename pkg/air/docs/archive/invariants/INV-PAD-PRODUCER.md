# INV-PAD-PRODUCER: Pad as a First-Class TAKE-Selectable Source

**Classification:** INVARIANT (Execution — Broadcast-Grade)
**Owner:** PipelineManager
**Enforcement Phase:** Every output tick within a BlockPlan session
**Depends on:** INV-TICK-GUARANTEED-OUTPUT, INV-BLOCK-WALLCLOCK-FENCE-001, LAW-OUTPUT-LIVENESS
**Supersedes:** BlackFrameProducerContract.md (for BlockPlan sessions only; legacy ProducerBus
failsafe path remains governed by the original contract)
**Created:** 2026-02-09
**Status:** Active

---

## Definition

The PadProducer is a first-class source that participates in TAKE source
selection at the frame commitment point.  It produces black video and silent
audio in the session's program format, unconditionally, on every request.

The PadProducer is not an inline fallback generated by the tick loop.  It is
a source — selected by the same TAKE mechanism that selects content sources.
Every frame that enters the encoder has a slot identity: live ('A'),
preview ('B'), or pad ('P').  No frame is fabricated outside the TAKE.

The PadProducer exists for the lifetime of the playout session.  It is
always ready.  It has no block affiliation, no priming phase, no exhaustion
state, and no resource dependencies beyond the session's program format.

---

## Scope

These invariants apply to:

- **Every output tick** where the TAKE cannot obtain a frame from a content
  source (A or B buffers).
- **Structural padding** segments where Core's block plan specifies pad as
  the intended content.
- **The PadProducer's participation in seam proof** (`commit_slot = 'P'`
  in FrameFingerprint records).
- **The relationship between the PadProducer and the content-before-pad gate.**

These invariants do NOT apply to:

- **Freeze-frame emission** (re-emission of the last real frame during a
  bounded hold window; governed by RealTimeHoldPolicy).
- **Legacy ProducerBus failsafe path** (BlackFrameProducer on the live bus;
  governed by BlackFrameProducerContract.md).
- **Session boot before the first real frame** (governed by
  INV-BOOT-IMMEDIATE-DECODABLE-OUTPUT and INV-AIR-CONTENT-BEFORE-PAD; the
  PadProducer is gated until the first real frame is committed).

---

## Definitions

| Term | Definition |
|------|------------|
| **PadProducer** | A session-lifetime source that produces black video and silent audio in the session's program format.  Always ready.  Selected by the TAKE at the commitment point when no content source can provide a frame. |
| **TAKE** | Source selection at the frame commitment point (pop→encode).  On each tick, the TAKE evaluates content buffer slots first (live, then preview at fence), then falls through to the PadProducer.  The selected slot is recorded in the seam proof as `commit_slot`. |
| **Commitment point** | The instant at which a frame is popped from a source's buffers and handed to the encoder.  This is the sole point where source identity is established.  No frame may enter the encoder except through the commitment point. |
| **commit_slot** | A character field in `FrameFingerprint` recording which **buffer slot** supplied the committed frame: `'A'` (live slot), `'B'` (preview/preroll slot), or `'P'` (PadProducer).  This is a slot identifier, not a block identifier — after a PADDED_GAP exit, a new block loaded from the queue into the live slot is labeled `'A'`.  Use `active_block_id` to identify the scheduled block. |
| **Program format** | The session's immutable output format: video resolution, pixel format (YUV420P), frame rate (rational fps_num/fps_den), audio sample rate (48 kHz), audio channel count (2), audio sample format (S16).  Fixed at session creation. |
| **ITU-R BT.601 black** | The standard representation of black in YUV420P: Y = 16, Cb = Cr = 128 (8-bit studio-range).  All pad video frames use this value uniformly across every pixel. |
| **Digital silence** | Audio samples with value zero across all channels.  All pad audio frames use this value for every sample. |
| **Content-before-pad gate** | The invariant (INV-AIR-CONTENT-BEFORE-PAD) requiring at least one real decoded content frame to be committed before any pad frame may be emitted.  This gate constrains the TAKE's selection logic, not the PadProducer itself. |
| **Freeze window** | A bounded interval (governed by RealTimeHoldPolicy) during which the last real frame may be re-emitted instead of falling through to pad.  Freeze is evaluated before the PadProducer in the TAKE's priority order. |

---

## Invariants

### INV-PAD-PRODUCER-001: Unconditional Availability

> The PadProducer MUST be capable of providing a valid frame on every
> request, without exception.  It MUST NOT enter an unready, exhausted,
> stalled, or error state.  Any request for a frame succeeds immediately
> with zero decode latency, zero I/O, and zero allocation.
>
> The PadProducer MUST NOT allocate per-frame heap memory during
> steady-state operation.  Frame buffers are pre-allocated at session
> start; subsequent frame requests populate pre-existing storage only.
>
> The PadProducer is ready from the moment the session begins and remains
> ready until the session terminates.  There is no priming phase, no
> warm-up, and no resource that can be depleted.

**Why:** The PadProducer is the terminal fallback in the TAKE's selection
chain.  If it could fail, the system would have no source to select, and
the tick would emit nothing — violating INV-TICK-GUARANTEED-OUTPUT.  Its
unconditional availability is what makes the guaranteed-output invariant
composable: the TAKE always has at least one source that can provide a
frame.

---

### INV-PAD-PRODUCER-002: Session-Format Conformance

> Every frame produced by the PadProducer MUST exactly match the session's
> program format:
>
> - **Video:** Resolution (width × height) and pixel format (YUV420P)
>   matching the session's ProgramFormat.
> - **Audio:** Sample rate (48 kHz), channel count (2), and sample format
>   (S16) matching the house audio format.  The number of audio samples
>   per pad frame MUST exactly match the session's audio-per-frame
>   cadence: `samples = sample_rate * fps_den / fps_num` (integer,
>   computed once at session start).
> - **Frame rate:** One video frame and its associated audio samples per
>   tick, at the session's rational frame rate.
>
> The encoder pipeline MUST NOT be able to distinguish a pad frame from a
> content frame by format, dimensions, sample rate, or encoding parameters.

**Why:** The encoder is content-agnostic by contract.  It encodes whatever
it receives, identically, regardless of origin.  If pad frames differ in
format from content frames, the encoder must either reject them (breaking
output liveness) or handle them specially (breaking content agnosticism).
Format conformance ensures the pad-to-encoder path is identical to the
content-to-encoder path.

---

### INV-PAD-PRODUCER-003: Deterministic Content

> The PadProducer's output is fixed and invariant:
>
> - **Video:** ITU-R BT.601 black (Y = 16, Cb = Cr = 128) uniformly
>   across every pixel of every frame.
> - **Audio:** Digital silence (all samples zero) across all channels.
>
> The output MUST NOT vary across frames, ticks, sessions, or any other
> dimension.  The PadProducer has no modes, no configuration that affects
> content, and no state that influences output.  Given the same program
> format, every pad frame is byte-identical in its uncompressed
> representation.
>
> The CRC32 Y-plane fingerprint (per SeamProofTypes) of every pad frame
> MUST be identical for a given resolution.

**Why:** Determinism is a broadcast-grade requirement.  If pad output
varied, seam proof verification could not distinguish "pad frame" from
"corrupt content frame."  Fixed output also means the PadProducer's
correctness can be verified once at session start and never re-checked.

---

### INV-PAD-PRODUCER-004: Timestamp Derivation from Session Frame Index

> PTS and DTS for pad frames MUST be derived deterministically from the
> session frame index and the session's rational frame duration:
>
> ```
> pts = session_frame_index * frame_duration
> dts = pts
> ```
>
> where `frame_duration` is the reciprocal of the session's rational frame
> rate expressed in the timebase of the output (90 kHz for MPEG-TS, or
> microseconds internally).
>
> Timestamps MUST NOT be derived from wall-clock reads, local
> accumulators, or the preceding frame's PTS.  Given the same session
> frame index and frame rate, the same PTS is produced — regardless of
> when the tick executes in real time.
>
> Successive pad frames MUST have strictly increasing PTS.  There MUST be
> no gaps (missing indices) and no overlaps (duplicate indices) in the
> timestamp sequence.  When pad frames are interleaved with content
> frames, the combined PTS sequence MUST remain monotonically increasing
> and gap-free.

**Why:** Wall-clock-derived timestamps couple pad frame timing to runtime
jitter, violating determinism.  Local accumulators can drift if the
PadProducer is selected and deselected across block boundaries.
Session-frame-index derivation is the only method that guarantees:
(a) determinism — same index always yields same PTS; (b) continuity — no
gaps when switching between content and pad; (c) independence from
selection history — the PadProducer does not need to know how many times
it has been selected or deselected.

---

### INV-PAD-PRODUCER-005: TAKE-Selectable Source with Recorded Identity

> The PadProducer MUST be selected by the TAKE at the commitment point
> using the same mechanism that selects content sources.  When selected:
>
> - `commit_slot` in the FrameFingerprint record MUST be `'P'`.
> - `is_pad` in the FrameFingerprint record MUST be `true`.
> - `asset_uri` MUST be a fixed sentinel value (e.g., `"internal://pad"`)
>   that is never used by content sources.
>
> The PadProducer MUST NOT be invoked outside the TAKE.  No component may
> inject a **video** pad frame into the output path by bypassing the
> commitment point.  The TAKE is the sole authority for video source
> selection; the PadProducer is one of its selectable sources.
>
> **Audio-only exception (FENCE_AUDIO_PAD):** At a fence tick, if the
> incoming block's audio buffer is not yet primed, PipelineManager MAY
> inject silence samples for that tick's audio frame.  This is a bounded
> exception: it applies only to the fence tick's audio, is
> diagnostic-logged with the `FENCE_AUDIO_PAD` tag, and does not affect
> video source selection or `commit_slot` identity.  FENCE_AUDIO_PAD
> does not invoke the PadProducer; it synthesizes audio samples directly.
>
> A TAKE event that selects the PadProducer MUST be logged identically in
> structure to a TAKE event that selects a content source.  The log
> distinguishes sources by slot (`'P'` vs `'A'` (live) / `'B'` (preview)),
> not by event type.

**Why:** The architectural ruling (INV-PAD-PRODUCER, parent document)
established that inline pad generation bypasses the TAKE's authority,
creating a second commitment path with no source identity.  By requiring
all pad frames to flow through the TAKE, every committed frame has a
uniform provenance: source identity, seam proof record, and audit trail.
The sentinel URI ensures as-run logs can distinguish pad from content
without inspecting pixel data.

---

### INV-PAD-PRODUCER-006: TAKE Selection Priority

> The TAKE MUST evaluate sources in the following strict priority order
> on each tick:
>
> 1. **Content source** (A or B, as determined by fence tick):
>    if the selected content buffer has a frame available, commit it.
> 2. **Freeze** (last committed real frame):
>    if a real frame was previously committed and the freeze window
>    (RealTimeHoldPolicy) has not expired, re-commit the held frame.
> 3. **PadProducer**:
>    unconditionally provides a frame.
>
> The PadProducer is strictly lowest priority.  It is selected only when
> both content and freeze are unavailable.  The TAKE MUST NOT select the
> PadProducer when a content source has a frame available.
>
> When a content source becomes available again (e.g., next block's
> preroll completes), the TAKE MUST select the content source on the next
> tick.  There is no "stuck in pad" state.

**Why:** Pad is the output of last resort.  Content is always preferred.
Freeze preserves visual continuity better than black and is preferred when
available and within its bounded window.  The strict priority order ensures
the PadProducer is selected if and only if no better source exists —
matching the broadcast principle that black air is always a continuity
measure, never a choice.

---

### INV-PAD-PRODUCER-007: Content-Before-Pad Gate

> The TAKE MUST NOT select the PadProducer until at least one real content
> frame has been committed in the session.
>
> This is a constraint on the TAKE's selection logic, not on the
> PadProducer itself.  The PadProducer is ready from session start, but
> the TAKE withholds it from selection until the content-before-pad
> condition is satisfied.
>
> If no content source is available at session boot, the session MUST hold
> (delay output) per INV-BOOT-IMMEDIATE-DECODABLE-OUTPUT rather than emit
> pad.  Once the first real frame has been committed, this gate is
> permanently satisfied for the session's lifetime.

**Why:** Pad frames (black video, silent audio) lack the codec
initialization data (IDR, SPS/PPS) that decoders need to begin playback.
Emitting pad before any real content causes player-side decode failure —
the viewer sees nothing, which is worse than a brief startup delay.  The
gate ensures the decoder is bootstrapped with real content before any pad
frames can appear.

---

### INV-PAD-PRODUCER-008: Session Lifetime, Not Block Lifetime

> The PadProducer exists for the duration of the playout session.  It is
> NOT assigned to blocks, does NOT track block boundaries or frame
> budgets, does NOT participate in fence calculations, and does NOT
> receive block metadata.
>
> Block-level concerns (budgets, fences, preroll, CT tracking) are
> irrelevant to the PadProducer.  Its output is identical regardless of
> which block is active, which block is pending, or whether a fence is
> imminent.
>
> The PadProducer is created once at session start and destroyed at
> session end.  It is not recycled, re-initialized, or reconfigured
> mid-session.

**Why:** The PadProducer's value derives from its simplicity and
statelessness.  If it tracked block boundaries, it would duplicate logic
that belongs to PipelineManager and TickProducer.  If it held per-block
state, it could enter inconsistent states during transitions.  Session
lifetime with zero block awareness makes it trivially correct: there is
nothing to get wrong.

---

### INV-PAD-PRODUCER-009: Zero-Cost Transition

> Transitioning to or from the PadProducer MUST complete within a single
> tick.  The TAKE selects the PadProducer on tick N; tick N emits a pad
> frame.  The TAKE selects a content source on tick N+1; tick N+1 emits
> a content frame.
>
> There is no setup, priming, warm-up, or initialization required to
> select the PadProducer.  There is no teardown, flush, or cleanup
> required to deselect it.  The transition cost is zero: source selection
> changes, and the next frame comes from the new source.

**Why:** Combined with INV-BLOCK-LOOKAHEAD-PRIMING (which may fail), the
system must be able to fall through to pad on any tick without delay.  If
the transition to pad required even one tick of setup, that tick would have
no source — violating INV-TICK-GUARANTEED-OUTPUT.  Zero-cost transition is
what makes the PadProducer a valid terminal fallback.

---

## Forbidden Patterns

| Pattern | Why Forbidden |
|---------|---------------|
| Generating a **video** pad frame inside the tick loop without going through the TAKE | Bypasses source selection authority; produces a frame with no `commit_slot` identity; creates a second commitment path.  (Audio-only FENCE_AUDIO_PAD at fence ticks is the documented exception — see INV-PAD-PRODUCER-005.) |
| Selecting the PadProducer before the first real content frame is committed | Violates INV-AIR-CONTENT-BEFORE-PAD; causes player-side decode failure |
| Deriving pad frame PTS from wall clock or from the preceding frame's PTS | Introduces runtime jitter into timestamps; breaks determinism; can cause gaps or overlaps when switching between content and pad |
| Assigning block metadata to the PadProducer or tracking per-block state within it | Duplicates PipelineManager logic; creates inconsistency risk during transitions; violates session-lifetime simplicity |
| Selecting the PadProducer when a content source has a frame available | Violates selection priority; emits black when content exists; indistinguishable from a bug |
| Varying pad frame content based on state, configuration, or frame index | Breaks determinism; invalidates CRC fingerprint verification; makes pad frames non-identical |

---

## Failure Modes

| Failure | Required Behavior | Governing Invariant |
|---------|-------------------|---------------------|
| Content source (A or B) returns no frame | TAKE evaluates freeze, then selects PadProducer | INV-PAD-PRODUCER-006 |
| Freeze window expired and content unavailable | TAKE selects PadProducer | INV-PAD-PRODUCER-006 |
| Content source becomes available after pad sequence | TAKE selects content source on next tick; PadProducer is simply not selected | INV-PAD-PRODUCER-006, 009 |
| Session starts with no content ready | Hold output per INV-BOOT-IMMEDIATE-DECODABLE-OUTPUT; do NOT select PadProducer | INV-PAD-PRODUCER-007 |
| Block fence fires but next block has no primed frame | TAKE selects PadProducer for fence tick and subsequent ticks until content is available | INV-PAD-PRODUCER-001, 006 |
| PadProducer selected for extended period (minutes+) | System continues emitting pad indefinitely; no resource exhaustion, no state corruption, no memory growth | INV-PAD-PRODUCER-001, 008 |

---

## Non-Goals

This contract explicitly does NOT address:

- **Internal buffer strategy** — whether pre-allocated storage is a
  singleton frame, a double buffer, or a ring is an implementation
  detail (provided INV-PAD-PRODUCER-001's no-per-frame-allocation
  constraint is satisfied).
- **Legacy ProducerBus failsafe** — the BlackFrameProducer on the live bus
  remains governed by BlackFrameProducerContract.md for non-BlockPlan
  sessions.
- **Slate, bars, tone, or other utility sources** — future utility sources
  may follow the same TAKE-selectable pattern but are not defined here.
- **How Core communicates structural padding** — the block plan format and
  gRPC messages are Core→AIR interface contracts, not PadProducer contracts.
- **Encoder behavior when receiving pad frames** — the encoder is
  content-agnostic; its contract (EncoderPipeline) governs its behavior
  regardless of input source.

---

## Relationship to Existing Contracts

### INV-TICK-GUARANTEED-OUTPUT (Parent — Provides)

The guaranteed-output invariant requires every tick to emit exactly one
frame.  The PadProducer is the mechanism that satisfies this guarantee when
content and freeze are both unavailable.  Without a TAKE-selectable pad
source, the guaranteed-output invariant would require inline frame
fabrication — which this contract eliminates.

### INV-BLOCK-WALLCLOCK-FENCE-001 (Sibling — Cooperates)

The fence determines which content source the TAKE evaluates (A before
fence, B after fence).  If the fence-selected source has no frame, the
TAKE falls through to the PadProducer.  The fence is timing authority; the
PadProducer is availability backstop.  They operate at different levels of
the selection chain and do not interact directly.

### INV-BLOCK-LOOKAHEAD-PRIMING (Sibling — Depends on Failure Path)

Priming prepares the next block's first frame before the fence tick.  If
priming fails (probe error, seek failure, missing file), the fence tick's
content source has no frame.  The PadProducer is the defined fallback for
priming failure — it absorbs the cost of failed priming without disrupting
the output stream.

### RealTimeHoldPolicy (Sibling — Priority Ordering)

Freeze (last-frame hold) takes precedence over the PadProducer when a real
frame exists and the hold window has not expired.  The freeze window is
bounded; once it expires, the TAKE falls through to the PadProducer.  The
two mechanisms are mutually exclusive on any given tick: either freeze
provides the frame, or the PadProducer does.

### BlackFrameProducerContract (Partially Superseded)

For BlockPlan sessions, the PadProducer replaces the legacy
BlackFrameProducer failsafe path.  The behavioral guarantees are identical
(black + silence, program format, monotonic timestamps), but the selection
mechanism changes: TAKE source selection replaces inline fallback.  The
legacy contract remains authoritative for non-BlockPlan sessions using the
ProducerBus architecture.

### INV-BLOCK-FRAME-BUDGET-AUTHORITY (Orthogonal)

The frame budget tracks how many frames a block owns.  Pad frames emitted
during a block (due to content underrun) still decrement the budget — the
block consumed a tick, regardless of what filled it.  The PadProducer does
not interact with the budget; PipelineManager decrements the budget on
every tick regardless of source.

| Contract | Relationship |
|----------|-------------|
| INV-TICK-GUARANTEED-OUTPUT | Parent: PadProducer satisfies the guarantee when content/freeze unavailable |
| INV-BLOCK-WALLCLOCK-FENCE-001 | Sibling: fence selects content source; PadProducer is fallback if source empty |
| INV-BLOCK-LOOKAHEAD-PRIMING | Sibling: priming failure → PadProducer absorbs the gap |
| RealTimeHoldPolicy | Sibling: freeze is evaluated before PadProducer in selection priority |
| BlackFrameProducerContract | Partially superseded: PadProducer replaces for BlockPlan sessions |
| INV-BLOCK-FRAME-BUDGET-AUTHORITY | Orthogonal: budget decrements regardless of source identity |
| INV-AIR-CONTENT-BEFORE-PAD | Parent: gates TAKE from selecting PadProducer before first real frame |
| INV-BOOT-IMMEDIATE-DECODABLE-OUTPUT | Sibling: governs session start behavior when no content ready |

---

## Required Tests

**File:** `pkg/air/tests/contracts/BlockPlan/PadProducerContractTests.cpp`

| Test Name | Invariant(s) | Description |
|-----------|-------------|-------------|
| `PadProducer_AlwaysReturnsFrame` | 001 | Request N frames (N > 10000); every request returns a valid frame with no nullopt, no error, no delay |
| `PadProducer_NeverEntersErrorState` | 001 | After creation, query readiness at arbitrary points across a simulated session; always ready |
| `PadProducer_NoPerFrameAllocation` | 001 | Request 10000 frames; verify heap allocation count does not increase after the first frame (pre-allocation only) |
| `PadProducer_VideoMatchesProgramFormat` | 002 | Create PadProducer with known ProgramFormat (e.g., 1280×720); verify every frame has correct width, height, and pixel format (YUV420P) |
| `PadProducer_AudioMatchesHouseFormat` | 002 | Verify audio output is 48 kHz, 2-channel, S16; sample count per frame matches session frame rate |
| `PadProducer_AudioSampleCountExact` | 002 | For each standard broadcast FPS (24, 25, 29.97, 30, 59.94, 60), verify audio sample count = 48000 × fps_den / fps_num per frame |
| `PadProducer_VideoIsBlack` | 003 | Verify Y plane is uniformly 16 and U/V planes are uniformly 128 across every pixel of the frame |
| `PadProducer_AudioIsSilent` | 003 | Verify all audio samples are zero across all channels |
| `PadProducer_CRC32Identical` | 003 | Compute CRC32YPlane for 100 consecutive frames; all values are identical |
| `PadProducer_PTSDerivedFromFrameIndex` | 004 | Request frames at session indices 0, 1, 2, ..., N; verify PTS(i) = i × frame_duration for each |
| `PadProducer_PTSMonotonicAndGapFree` | 004 | Request 1000 frames; verify PTS is strictly increasing with constant delta equal to frame_duration |
| `PadProducer_PTSDeterministic` | 004 | Request frame at index K twice (via reset or independent instances with same format); verify identical PTS both times |
| `PadProducer_PTSNoWallClockDependency` | 004 | Request frame at index K, sleep 500 ms, request frame at index K again; PTS must be identical (no clock contamination) |
| `PadProducer_CommitSourceIsP` | 005 | Run a tick sequence where content is unavailable; verify every FrameFingerprint has commit_slot = 'P' and is_pad = true |
| `PadProducer_AssetUriIsSentinel` | 005 | Verify asset_uri in FrameFingerprint is the fixed sentinel value for every pad frame |
| `PadProducer_NotSelectedWhenContentAvailable` | 006 | Run a tick sequence with content source providing frames; verify commit_slot is never 'P' |
| `PadProducer_SelectedAfterContentExhausts` | 006 | Content source provides 10 frames then exhausts; verify subsequent ticks have commit_slot = 'P' |
| `PadProducer_FreezeBeforePad` | 006 | Content source exhausts within freeze window; verify freeze frames precede pad frames in output sequence |
| `PadProducer_ReturnsToContentFromPad` | 006 | Content unavailable for 10 ticks (pad), then becomes available; verify next tick has commit_slot = 'A' or 'B', not 'P' |
| `PadProducer_ContentBeforePadGateHolds` | 007 | Start session with no content ready; verify PadProducer is not selected (no commit_slot = 'P') until after first real frame |
| `PadProducer_GatePermanentAfterFirstFrame` | 007 | Commit one real frame, then remove content; verify PadProducer is now selectable (gate permanently satisfied) |
| `PadProducer_NoBlockState` | 008 | Advance through 3 block boundaries; verify PadProducer holds no block ID, no fence value, no frame budget |
| `PadProducer_SurvivesExtendedEmission` | 008 | Request 100000 frames; verify no memory growth (RSS delta < 1 MB), no state corruption, no resource exhaustion |
| `PadProducer_TransitionToWithinOneTick` | 009 | Content available on tick N, unavailable on tick N+1; verify tick N+1 emits a pad frame (no setup delay) |
| `PadProducer_TransitionFromWithinOneTick` | 009 | Pad on tick N, content available on tick N+1; verify tick N+1 emits a content frame (no teardown delay) |
| `PadProducer_PTSContinuousAcrossContentToPad` | 004, 009 | Content emits frames 0–9, pad emits frames 10–19; verify combined PTS sequence is monotonic with no gaps at the boundary |
| `PadProducer_PTSContinuousAcrossPadToContent` | 004, 009 | Pad emits frames 0–4, content emits frames 5–14; verify combined PTS sequence is monotonic with no gaps at the boundary |
| `PadProducer_FenceTakeWithNoPrimedFrame` | 001, 006 | Fence fires but next block has no primed frame (priming failure); verify pad frame emitted on fence tick with correct commit_slot |
| `PadProducer_BoundaryReportShowsPadFrames` | 003, 005 | Run a fence transition where pad fills 3 ticks; verify BoundaryReport correctly counts pad_frames_in_window and records 'P' source |

---

## Logging

TAKE selection (compliance):
```
[PipelineManager] INV-PAD-PRODUCER-005: TAKE selected PadProducer at session_frame_index={idx} (content={A|B} unavailable, freeze={available|expired|none})
```

Return to content (compliance):
```
[PipelineManager] INV-PAD-PRODUCER-006: TAKE returned to content source '{A|B}' at session_frame_index={idx} after {n} pad frames
```

Content-before-pad gate hold (compliance):
```
[PipelineManager] INV-PAD-PRODUCER-007: content-before-pad gate active; holding PadProducer selection at session_frame_index={idx}
```

Gate satisfied (compliance):
```
[PipelineManager] INV-PAD-PRODUCER-007: content-before-pad gate satisfied at session_frame_index={idx}; PadProducer now selectable
```

Format mismatch (violation — should never occur):
```
[PipelineManager] INV-PAD-PRODUCER-002 VIOLATION: pad frame format mismatch (expected {w}x{h} YUV420P, got {actual})
```

---

## Changelog

- 2026-02-09: Initial proposal.  Derived from architectural ruling
  (pad frames as first-class TAKE-selectable source), behavioral contract
  (pad frame semantics), and responsibility audit (architectural layer
  separation).  Supersedes inline pad generation in BlockPlan sessions.
