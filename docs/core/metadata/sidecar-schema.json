{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://retrovue.dev/schemas/sidecar-0.1.0.json",
  "title": "RetroVue Sidecar Schema",
  "type": "object",
  "additionalProperties": false,
  "required": ["asset_type", "_meta"],
  "properties": {
    "asset_type": {
      "type": "string",
      "enum": ["episode", "movie", "promo", "bumper", "ad", "block"]
    },
    "title": { "type": "string" },
    "description": { "type": "string" },
    "genres": {
      "type": "array",
      "items": { "type": "string" },
      "uniqueItems": false
    },
    "runtime_seconds": { "type": "integer", "minimum": 0 },
    "aspect_ratio": { "type": "string", "pattern": "^\\d+:\\d+$" },
    "resolution": { "type": "string", "enum": ["480p", "720p", "1080p", "2160p"] },
    "content_rating": {
      "$ref": "#/definitions/content_rating"
    },
    "external_ids": {
      "type": "object",
      "additionalProperties": { "type": "string" }
    },
    "season_number": { "type": "integer", "minimum": 0 },
    "episode_number": { "type": "integer", "minimum": 0 },
    "promoted_asset_type": { "type": "string", "enum": ["series", "movie", "episode"] },
    "campaign_name": { "type": "string" },
    "advertiser": { "type": "string" },
    "air_window_start": { "type": "string", "format": "date" },
    "air_window_end": { "type": "string", "format": "date" },
    "call_to_action": { "type": "string" },
    "bump_type": { "type": "string" },
    "relationships": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "series_id": { "$ref": "#/definitions/uuid" },
        "season_id": { "$ref": "#/definitions/uuid" },
        "promoted_asset_id": { "$ref": "#/definitions/uuid" }
      }
    },
    "station_ops": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "content_class": { "type": "string" },
        "daypart_profile": { "type": "string" },
        "ad_avail_model": { "type": "string" }
      }
    },
    "_meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema", "version"],
      "properties": {
        "schema": { "type": "string", "const": "retrovue.sidecar" },
        "version": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$" },
        "scope": { "type": "string", "enum": ["file", "series", "collection"] },
        "importer_hints": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "source_system": { "type": "string" },
            "source_uri": { "type": "string" }
          }
        },
        "authoritative_fields": {
          "type": "array",
          "items": { "type": "string" }
        },
        "notes": { "type": "string" }
      }
    }
  },
  "oneOf": [
    {
      "title": "Episode sidecar",
      "properties": { "asset_type": { "const": "episode" } }
    },
    {
      "title": "Movie sidecar",
      "properties": { "asset_type": { "const": "movie" } }
    },
    {
      "title": "Promo sidecar",
      "allOf": [
        { "properties": { "asset_type": { "const": "promo" } } },
        { "required": ["relationships"] },
        { "properties": { "relationships": { "required": ["promoted_asset_id"] } } }
      ]
    },
    {
      "title": "Bumper sidecar",
      "properties": { "asset_type": { "const": "bumper" } }
    },
    {
      "title": "Ad sidecar",
      "properties": { "asset_type": { "const": "ad" } }
    },
    {
      "title": "Block sidecar",
      "properties": { "asset_type": { "const": "block" } }
    }
  ],
  "definitions": {
    "uuid": {
      "type": "string",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
    },
    "content_rating": {
      "type": "object",
      "additionalProperties": false,
      "required": ["system", "code"],
      "properties": {
        "system": { "type": "string" },
        "code": { "type": "string" },
        "reason": { "type": "string" }
      }
    }
  }
}


