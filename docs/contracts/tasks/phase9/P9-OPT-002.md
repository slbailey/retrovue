Task ID: P9-OPT-002
Rule ID: —
Governing Law: —
Subsystem: MetricsExporter
Task Type: OPTIONAL
File(s) to Modify: pkg/air/src/telemetry/MetricsExporter.cpp
Owner: AIR
Blocked By: P9-CORE-001

Instructions:
- Add steady-state metrics to `/metrics` endpoint
- `retrovue_steady_state_active` (gauge): 1 if steady-state active, 0 otherwise
- `retrovue_steady_state_duration_seconds` (counter): time in steady-state
- `retrovue_mux_ct_wait_ms` (histogram): time mux waits for CT
- `retrovue_pad_while_depth_high_total` (counter): INV-P9-STEADY-004 violations
- `retrovue_equilibrium_violations_total` (counter): depth outside range
- `retrovue_decode_gate_blocks_total` (counter): producer blocked at capacity

---

Implementation:

```cpp
void MetricsExporter::RegisterSteadyStateMetrics() {
    // Gauges
    RegisterGauge("retrovue_steady_state_active",
                  "Whether steady-state pacing is active (1=yes, 0=no)");

    // Counters
    RegisterCounter("retrovue_steady_state_duration_seconds",
                    "Total time spent in steady-state");
    RegisterCounter("retrovue_pad_while_depth_high_total",
                    "Pad emissions while buffer depth >= 10");
    RegisterCounter("retrovue_equilibrium_violations_total",
                    "Buffer depth outside equilibrium range");
    RegisterCounter("retrovue_decode_gate_blocks_total",
                    "Producer blocked at buffer capacity");

    // Histograms
    RegisterHistogram("retrovue_mux_ct_wait_ms",
                      "Time mux waits for frame CT (milliseconds)",
                      {1, 5, 10, 20, 33, 50, 100});
}

void MetricsExporter::UpdateSteadyStateMetrics(
    const SteadyStateMetrics& metrics) {
    SetGauge("retrovue_steady_state_active",
             metrics.steady_state_active ? 1 : 0);
    IncrementCounter("retrovue_steady_state_duration_seconds",
                     metrics.duration_seconds_delta);
    SetCounter("retrovue_pad_while_depth_high_total",
               metrics.pad_while_depth_high);
    SetCounter("retrovue_equilibrium_violations_total",
               metrics.equilibrium_violations);
    SetCounter("retrovue_decode_gate_blocks_total",
               metrics.decode_gate_blocks);
    ObserveHistogram("retrovue_mux_ct_wait_ms",
                     metrics.mux_ct_wait_ms);
}
```

Done Criteria:
All metrics exported at `/metrics`; Prometheus can scrape; values update correctly during playout.
