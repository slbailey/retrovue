Task ID: P12-TEST-012
Rule ID: INV-STARTUP-CONVERGENCE-001, INV-STARTUP-BOUNDARY-FEASIBILITY-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: ChannelManager
Task Type: TEST
File(s) to Modify: pkg/core/tests/runtime/test_channel_manager_startup.py
Owner: Core
Blocked By: P12-CORE-011

Instructions:
- Add contract tests for post-convergence feasibility enforcement
- Verify infeasible boundaries are FATAL after convergence
- Verify steady-state rules apply after first successful boundary
- Test transition from convergence to converged state

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition (INV-STARTUP-BOUNDARY-FEASIBILITY-001 - Amended):
Post-convergence: INV-STARTUP-BOUNDARY-FEASIBILITY-001 applies in full. Infeasible boundaries after convergence are FATAL (planning error).

Test Cases:

1. Test infeasible boundary fatal after convergence:
   - Setup: Session converged (`_converged = True`); next boundary in 3s (infeasible)
   - Action: Evaluate boundary
   - Expected: `_boundary_state = FAILED_TERMINAL`; not skipped

2. Test FATAL logged for post-convergence infeasibility:
   - Setup: Converged session; infeasible boundary
   - Action: Evaluate boundary
   - Expected: Log contains "INV-STARTUP-BOUNDARY-FEASIBILITY-001 FATAL"

3. Test feasible boundaries work after convergence:
   - Setup: Session converged; next boundary in 30s (feasible)
   - Action: Evaluate and execute boundary
   - Expected: Boundary committed and executed normally

4. Test convergence transition is one-way:
   - Setup: Session converges at T+10s
   - Action: Check `_converged` at T+20s, T+60s, T+120s
   - Expected: `_converged = True` at all times; never reverts

5. Test no re-entry to convergence:
   - Setup: Session converged; some boundaries execute
   - Action: Attempt to set `_converged = False` (should not be possible)
   - Expected: `_converged` remains True; no API to reset it

6. Test steady-state feasibility rules apply:
   - Setup: Session converged
   - Action: Evaluate boundaries as in steady-state operation
   - Expected: Full INV-STARTUP-BOUNDARY-FEASIBILITY-001 enforcement

7. Test convergence flag set exactly once:
   - Setup: Session executes multiple boundaries
   - Action: Track convergence flag transitions
   - Expected: False â†’ True on first boundary; never changes after

8. Test _convergence_deadline cleared after convergence:
   - Setup: Session converges
   - Action: Check `_convergence_deadline`
   - Expected: `_convergence_deadline = None` after convergence

Done Criteria:
Post-convergence infeasibility is FATAL; convergence is one-way; steady-state rules apply after first boundary; no re-entry to convergence mode.

---

## Completion

- **Date:** 2026-02-02
- **Implementation:** `pkg/core/tests/runtime/test_channel_manager_startup.py`
  - test_p12_infeasible_boundary_fatal_after_convergence: _converged True, infeasible boundary -> FAILED_TERMINAL, _pending_fatal.
  - test_p12_convergence_transition_sets_converged: SWITCH_ISSUED -> LIVE sets _converged True, _convergence_deadline None.
  - test_p12_converged_property_after_transition: converged property True after LIVE; one-way.
  - test_p12_convergence_deadline_cleared_after_convergence: _convergence_deadline None after first LIVE.
  - test_p12_no_skip_when_converged_infeasible_fatal (in P12-TEST-010 block): post-convergence infeasible -> FATAL.
- **Tests:** 17 startup tests; 148 runtime tests total.
