Task ID: P12-CORE-008
Rule ID: INV-TERMINAL-SCHEDULER-HALT-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: ChannelManager
Task Type: FIX
File(s) to Modify: pkg/core/src/retrovue/runtime/channel_manager.py
Owner: Core
Blocked By: P12-CORE-005

Instructions:
- Add FAILED_TERMINAL check to `tick()` and scheduling entry points
- Return early before evaluating boundary logic if in FAILED_TERMINAL
- Check is independent of `_teardown_pending` check
- Allowed operations: health, metrics, diagnostics, logging, teardown

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition (INV-TERMINAL-SCHEDULER-HALT-001):
Once `_boundary_state == FAILED_TERMINAL`, Core MUST NOT generate new scheduling intent. Scheduling intent is any operation that:
1. Allocates resources for future boundary work (e.g., preview buffers)
2. Sends control-plane RPCs to AIR (e.g., LoadPreview, SwitchToLive)
3. Registers timers for boundary lifecycle operations
4. Would require a boundary state transition to complete

Implementation:

1. In `tick()`, after grace timeout check and teardown-pending check:
   - Check: `if self._boundary_state == BoundaryState.FAILED_TERMINAL`
   - If true: log debug "Skipping boundary work (terminal failure)", return early
   - This prevents any scheduling evaluation in terminal state

2. In any method that explicitly schedules LoadPreview or SwitchToLive:
   - Check `_boundary_state == FAILED_TERMINAL` before scheduling
   - If true: log warning "Cannot schedule: terminal failure", return early

3. Order of checks in `tick()`:
   - Grace timeout check (P12-CORE-004) — may transition to FAILED_TERMINAL
   - Teardown pending check (P12-CORE-005) — skip work if winding down
   - Terminal failure check (this task) — skip work if dead
   - Normal boundary evaluation

Constraints:
- MUST NOT block health checks, metrics, or diagnostics
- MUST NOT block teardown coordination
- Check is independent of `_teardown_pending` (both must be evaluated)
- Logging is allowed in FAILED_TERMINAL

Explicitly Allowed in FAILED_TERMINAL:
- Health check evaluation and reporting
- Metrics collection and export
- Diagnostic state reads
- Logging
- Teardown coordination

Done Criteria:
No scheduling intent generated when `_boundary_state == FAILED_TERMINAL`; tick() returns early; no spurious "VIOLATION" logs for doomed operations.

---

## Completion

**Completed:** 2025-02-02

**Changes (pkg/core/src/retrovue/runtime/channel_manager.py):**
- In `tick()`, after grace timeout and teardown-pending checks: if `_boundary_state == BoundaryState.FAILED_TERMINAL`, log debug "INV-TERMINAL-SCHEDULER-HALT-001: Skipping boundary work (terminal failure)", return early. No new scheduling intent in FAILED_TERMINAL.
