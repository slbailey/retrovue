Task ID: P12-CORE-012
Rule ID: INV-STARTUP-CONVERGENCE-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: ChannelManager
Task Type: FIX
File(s) to Modify: pkg/core/src/retrovue/runtime/channel_manager.py
Owner: Core
Blocked By: P12-CORE-011

Instructions:
- Implement boundary skip logic for infeasible boundaries during startup convergence
- When boundary is infeasible and not converged: skip boundary, continue current segment
- Log skipped boundaries as STARTUP_BOUNDARY_SKIPPED (not a violation)
- Evaluate next boundary after skip

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition (INV-STARTUP-CONVERGENCE-001):
During startup convergence, infeasible boundaries are skipped, not fatal. A boundary is skipped if `boundary_time < now + MIN_PREFEED_LEAD_TIME` at the time of evaluation.

Implementation:

1. In boundary evaluation logic (where feasibility is checked):
   ```python
   def _evaluate_boundary_feasibility(self, boundary_time: datetime) -> bool:
       now = datetime.now(timezone.utc)
       lead_time = boundary_time - now
       min_required = timedelta(milliseconds=MIN_PREFEED_LEAD_TIME_MS)

       if lead_time >= min_required:
           return True  # Feasible: commit boundary

       if not self._converged:
           # Pre-convergence: skip is allowed
           self._logger.info(
               "STARTUP_BOUNDARY_SKIPPED: boundary=%s lead_time=%s min_required=%s",
               boundary_time, lead_time, min_required
           )
           self._schedule_next_boundary_evaluation(boundary_time)
           return False  # Skip this boundary

       # Post-convergence: infeasibility is fatal
       self._logger.error(
           "INV-STARTUP-BOUNDARY-FEASIBILITY-001 FATAL: Infeasible boundary post-convergence"
       )
       self._transition_boundary_state(BoundaryState.FAILED_TERMINAL)
       return False
   ```

2. When a boundary is skipped:
   - No LoadPreview is issued for that boundary
   - No SwitchToLive is scheduled for that boundary
   - Current segment continues playing past the boundary time
   - At the boundary time, Core evaluates the *next* boundary

3. Schedule next boundary evaluation:
   ```python
   def _schedule_next_boundary_evaluation(self, skipped_boundary_time: datetime):
       # At the skipped boundary time, evaluate the subsequent boundary
       delay = (skipped_boundary_time - datetime.now(timezone.utc)).total_seconds()
       self._loop.call_later(max(0, delay), self._evaluate_next_boundary)
   ```

4. Log format for skipped boundaries:
   ```
   STARTUP_BOUNDARY_SKIPPED: boundary=2026-02-02T16:35:00Z lead_time=4.5s min_required=5.0s
   ```

Constraints:
- Skipped boundaries are NOT violations (not logged as VIOLATION)
- Skip logic ONLY applies when `_converged == False`
- Post-convergence infeasibility is FATAL (INV-STARTUP-BOUNDARY-FEASIBILITY-001)
- Current segment continues playing during skip (no interruption)

Rationale:
A skipped boundary means we *chose not to attempt* it because it was infeasible by construction. This is different from a failed boundary (attempted and failed). During startup convergence, this is acceptable behavior that allows "play something now" semantics.

Done Criteria:
Infeasible boundaries skipped during startup convergence; STARTUP_BOUNDARY_SKIPPED logged; next boundary evaluated at skipped boundary time; post-convergence infeasibility is FATAL.

---

## Completion

- **Date:** 2026-02-02
- **Implementation:** `channel_manager.py`
  - In `tick()`, after `segment_end`/`now` and after convergence timeout check: if `(segment_end - now) < MIN_PREFEED_LEAD_TIME` (infeasible), then if not `_converged`: log `STARTUP_BOUNDARY_SKIPPED` with boundary, lead_time, min_required; call `_advance_to_next_boundary_after_skip(segment_end)`; return. If `_converged`: log `INV-STARTUP-BOUNDARY-FEASIBILITY-001 FATAL`, set `_pending_fatal`, `_transition_boundary_state(FAILED_TERMINAL)`, return.
  - Added `_advance_to_next_boundary_after_skip(skipped_boundary_time)`: uses `get_playout_plan_now(channel_id, skipped_boundary_time)` to set `_segment_end_time_utc` and `_plan_boundary_ms` from next segment (or None). No LoadPreview/SwitchToLive for skipped boundary; current segment continues.
- **Tests:** Runtime suite 131 passed. Contract tests P12-TEST-010/011/012 pending.
