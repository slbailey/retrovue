Task ID: P12-TEST-010
Rule ID: INV-STARTUP-CONVERGENCE-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: ChannelManager
Task Type: TEST
File(s) to Modify: pkg/core/tests/runtime/test_channel_manager_startup.py
Owner: Core
Blocked By: P12-CORE-012

Instructions:
- Add contract tests for boundary skip during startup convergence
- Verify infeasible boundaries skipped (not fatal) before convergence
- Verify STARTUP_BOUNDARY_SKIPPED logged
- Verify next boundary evaluated after skip

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition (INV-STARTUP-CONVERGENCE-001):
During startup convergence, infeasible boundaries are skipped, not fatal.

Test Cases:

1. Test boundary skipped when infeasible during convergence:
   - Setup: Session created; `_converged = False`; next boundary in 3s (infeasible)
   - Action: Evaluate boundary
   - Expected: Boundary skipped; no legacy preload RPC issued; no FAILED_TERMINAL

2. Test STARTUP_BOUNDARY_SKIPPED logged:
   - Setup: Session created; infeasible boundary
   - Action: Evaluate boundary
   - Expected: Log contains "STARTUP_BOUNDARY_SKIPPED" with boundary time and lead time

3. Test multiple boundaries skipped in sequence:
   - Setup: Session created; next 3 boundaries all infeasible
   - Action: Evaluate each boundary in sequence
   - Expected: All 3 skipped; still in convergence; content continues

4. Test current segment continues during skip:
   - Setup: Session playing segment A; boundary to segment B is infeasible
   - Action: Boundary time passes
   - Expected: Segment A continues playing (no switch attempted)

5. Test next boundary evaluated after skip:
   - Setup: Boundary at T+3s (infeasible); boundary at T+63s (feasible)
   - Action: Skip first boundary
   - Expected: At T+3s, second boundary is evaluated and committed

6. Test convergence achieved after skip + successful boundary:
   - Setup: First boundary skipped; second boundary feasible
   - Action: Execute second boundary successfully
   - Expected: `_converged = True` after second boundary completes

7. Test no skip when converged:
   - Setup: Session converged (`_converged = True`); infeasible boundary
   - Action: Evaluate infeasible boundary
   - Expected: FAILED_TERMINAL (post-convergence infeasibility is fatal)

8. Test skip does not count as violation:
   - Setup: Session in convergence; boundary skipped
   - Action: Check logs
   - Expected: No "VIOLATION" in logs; only "STARTUP_BOUNDARY_SKIPPED"

Done Criteria:
Infeasible boundaries skipped during convergence; STARTUP_BOUNDARY_SKIPPED logged; content continues during skip; next boundary evaluated; post-convergence infeasibility is fatal.

---

## Completion

- **Date:** 2026-02-02
- **Implementation:** `pkg/core/tests/runtime/test_channel_manager_startup.py`
  - test_p12_boundary_skipped_when_infeasible_during_convergence: infeasible boundary during convergence skipped; no FAILED_TERMINAL; STARTUP_BOUNDARY_SKIPPED in logs.
  - test_p12_startup_boundary_skipped_log_format: log contains boundary/lead_time/min_required.
  - test_p12_next_boundary_evaluated_after_skip: _segment_end_time_utc advances after skip.
  - test_p12_no_skip_when_converged_infeasible_fatal: post-convergence infeasible -> FAILED_TERMINAL, INV-STARTUP-BOUNDARY-FEASIBILITY-001 FATAL.
  - test_p12_skip_does_not_log_violation: STARTUP_BOUNDARY_SKIPPED present (skip path, not violation).
- **Tests:** 17 startup tests; 148 runtime tests total.
