Task ID: P11C-004
Rule ID: INV-BOUNDARY-DECLARED-001
Subsystem: ChannelManager
Task Type: FIX
File(s) to Modify: pkg/core/retrovue/runtime/channel_manager.py
Owner: Core
Blocked By: P11C-002

Instructions:
- Populate target_boundary_time_ms in SwitchToLiveRequest
- Value comes from the scheduled grid boundary time

---

Rule Definition:
SwitchToLive MUST include `target_boundary_time_ms` parameter; Core declares intent, AIR executes at that time.

Implementation:

1. In ChannelManager.switch_to_live() or equivalent:
   ```python
   # Get scheduled boundary time from current schedule
   boundary_time = self._get_current_grid_boundary_time()

   request = SwitchToLiveRequest(
       channel_id=channel_id,
       plan_handle=plan_handle,
       target_boundary_time_ms=int(boundary_time.timestamp() * 1000)
   )
   ```

2. Add helper to get grid boundary:
   ```python
   def _get_current_grid_boundary_time(self) -> datetime:
       """Returns the scheduled boundary time for the current switch."""
       # Use schedule manager to get next grid boundary
       return self.schedule_manager.get_next_boundary_time(self.channel_id)
   ```

3. Log the declaration:
   ```python
   logger.info(f"INV-BOUNDARY-DECLARED-001: Declaring switch at target_boundary_time_ms={target_ms}")
   ```

Source of Truth:
- Grid boundary times come from ScheduleManager
- Boundaries are at :00 and :30 per LAW-004 (Grid Boundaries Sacred)
- Convert datetime to Unix epoch milliseconds

Constraints:
- Must use actual scheduled boundary, not "now"
- Must handle edge cases (e.g., switch requested after boundary)
- Log the declared target for correlation with AIR logs

Done Criteria:
Core sends target_boundary_time_ms in every SwitchToLive request based on schedule.

---

Completion (2026-02-01): air_switch_to_live(..., target_boundary_time_ms); Phase8AirProducer.switch_to_live(target_boundary_time_utc=segment_end); tick() passes segment_end.
