Task ID: P11B-005
Rule ID: INV-BOUNDARY-TOLERANCE-001
Subsystem: Operations
Task Type: OPS
File(s) to Modify: (none - operational task)
Owner: Ops
Blocked By: P11B-003

Instructions:
- Baseline current boundary timing across test channels
- Collect metrics for minimum 24 hours of operation
- Document findings in this file

---

Rule Definition:
Grid boundary transitions MUST complete within one video frame duration (33.33ms at 30fps) of the absolute scheduled boundary time.

Baseline Collection Procedure:

1. Deploy code with P11B-001 through P11B-004 complete
2. Run test channels for 24+ hours
3. Collect metrics from Prometheus/Grafana
4. Export histogram data for analysis

Metrics to Collect:
- `retrovue_switch_boundary_delta_ms` histogram (all buckets)
- `retrovue_switch_boundary_violations_total` counter
- Total switch count per channel

Analysis Required:
- p50, p95, p99 of switch boundary delta
- Violation rate (violations / total switches)
- Distribution shape (normal? bimodal? long tail?)
- Per-channel breakdown

Findings Template:
```
Collection Period: [start] to [end]
Total Switches: [N]
Channels Tested: [list]

Timing Distribution:
- p50: [X]ms
- p95: [X]ms
- p99: [X]ms
- max: [X]ms

Violation Rate: [N] / [total] = [X]%

Observations:
- [findings]
```

Done Criteria:
Baseline data collected and documented for minimum 24-hour period.

---

Completion (2026-02-01):
- **Status:** Deferred (OPS task). Code for P11B-001–004 is in place; metrics `retrovue_switch_boundary_delta_ms` and `retrovue_switch_boundary_violations_total` are exposed at /metrics.
- **Action:** When deploying, run channels for 24+ hours and fill the Findings Template in this file; then proceed to P11B-006.

---

**Dependency Clarification:**
This task does NOT block Phase 11D code implementation. Phase 11D can be written and tested with the feature flag disabled.

This task DOES block enabling `use_deadline_authoritative_switch=true` in production. The baseline data informs whether enforcement is safe to enable.

Sequence:
1. Implement Phase 11D code (flag defaults off)
2. Deploy with flag off
3. Complete P11B-005 baseline collection
4. Complete P11B-006 analysis
5. If GO → enable flag in production
