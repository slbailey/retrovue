Task ID: P11F-001
Rule ID: INV-CONTROL-NO-POLL-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: ChannelManager
Task Type: FIX
File(s) to Modify: pkg/core/src/retrovue/usecases/channel_manager_launch.py
Owner: Core
Blocked By: —

Instructions:
- Fix `_MIN_PREFEED_LEAD_TIME_MS` typo → `MIN_PREFEED_LEAD_TIME_MS`
- This bug causes NameError at runtime, leading to retry cascades

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition:
Variable names must match their imports. The constant is imported as `MIN_PREFEED_LEAD_TIME_MS` but referenced as `_MIN_PREFEED_LEAD_TIME_MS` at line 291.

Implementation:

1. Locate the typo in channel_manager_launch.py:
   ```python
   # Line 264: imports correctly
   from retrovue.runtime.constants import MIN_PREFEED_LEAD_TIME_MS

   # Line 291: typo
   _MIN_PREFEED_LEAD_TIME_MS,  # WRONG
   ```

2. Fix:
   ```python
   MIN_PREFEED_LEAD_TIME_MS,  # CORRECT
   ```

Root Cause:
This typo causes `NameError` during legacy switch RPC issuance. The exception is caught but not treated as terminal, allowing tick-based retry. Each retry reduces lead time, eventually going negative and triggering INV-CONTROL-NO-POLL-001 violations.

Done Criteria:
No NameError when issuing legacy switch RPC; logging correctly references MIN_PREFEED_LEAD_TIME_MS.

---

## Completion Status

| Field | Value |
|-------|-------|
| **Status** | COMPLETE |
| **Completed** | 2026-02-02 |
| **Fix** | Line 291 (and launch path line 501): use `MIN_PREFEED_LEAD_TIME_MS`; no `_MIN_PREFEED_LEAD_TIME_MS` in codebase. |
| **Verification** | `channel_manager_launch.py` imports and references `MIN_PREFEED_LEAD_TIME_MS` only (grep-confirmed). |
| **Tests** | `pytest pkg/core/tests/runtime/test_prefeed_timing.py pkg/core/tests/runtime/test_clock_driven_switch.py` — 9 passed; no NameError; logging uses MIN_PREFEED_LEAD_TIME_MS. |
| **Unblocks** | P11F-002 |
