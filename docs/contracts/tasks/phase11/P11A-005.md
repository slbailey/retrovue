Task ID: P11A-005
Rule ID: INV-P10-BACKPRESSURE-SYMMETRIC (amended), INV-AUDIO-SAMPLE-CONTINUITY-001
Subsystem: FileProducer
Task Type: VERIFY
File(s) to Modify: pkg/air/tests/contracts/Phase10PipelineFlowControlTests.cpp (update existing)
Owner: AIR
Blocked By: P11A-003

Instructions:
- Update existing INV-P10-BACKPRESSURE-SYMMETRIC tests to include audio
- Verify that audio is throttled symmetrically with video
- Confirm amended rule definition is enforced

---

Rule Definition (Amended):
When buffer full, both audio and video throttled symmetrically. **Audio samples MUST NOT be dropped due to queue backpressure; overflow MUST cause producer throttling.**

Verification Scope:

1. Review existing Phase10PipelineFlowControlTests.cpp
2. Confirm tests cover audio+video symmetric throttling
3. If gaps exist, add test cases

Test Cases to Verify/Add:

TEST_INV_P10_BACKPRESSURE_SYMMETRIC_AudioAndVideo
- Given: Both audio and video queues approaching capacity
- When: Backpressure is triggered
- Then: Both audio and video production pause together
- And: Neither stream "runs ahead" of the other

TEST_INV_P10_BACKPRESSURE_SYMMETRIC_NoAudioDrops
- Given: Backpressure condition active
- When: Audio frames are being produced
- Then: Audio frames are NOT dropped
- And: Producer blocks until queue has space

Assertions Required:
1. |audio_backpressure_time - video_backpressure_time| < 1 frame duration
2. audio_samples_dropped == 0 during backpressure
3. Backpressure release is also symmetric

Done Criteria:
Tests confirm audio and video are throttled together with no audio drops.

---

Completion (2026-02-01): TEST_INV_P10_BACKPRESSURE_SYMMETRIC_NoAudioDrops added to Phase10PipelineFlowControlTests.cpp.
