Task ID: P11D-010
Rule ID: INV-STARTUP-BOUNDARY-FEASIBILITY-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: ChannelManager/Scheduler
Task Type: FIX
File(s) to Modify: pkg/core/src/retrovue/runtime/channel_manager.py
Owner: Core
Blocked By: P11D-009
Blocks: P11D-006

Instructions:
- First scheduled boundary MUST satisfy startup feasibility constraint
- Startup latency is a schedule content constraint, not a planning_time offset
- If no feasible first boundary exists, planning MUST fail immediately (FATAL)

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Clock authority is absolute; startup overhead does not suspend the clock. If the first boundary cannot be honored due to startup latency, runtime has no legal recovery mechanism.

Rule Definition (INV-STARTUP-BOUNDARY-FEASIBILITY-001):

The first scheduled boundary MUST satisfy:

```
boundary_time >= station_utc + startup_latency + MIN_PREFEED_LEAD_TIME
```

Where:
- `station_utc` is the planning time (unmodified)
- `startup_latency` is a bounded, declared upper limit on channel launch overhead
- `MIN_PREFEED_LEAD_TIME` is the minimum lead time required by INV-CONTROL-NO-POLL-001

If no such boundary exists in the schedule, planning MUST fail immediately with a FATAL error, because runtime execution has no legal mechanism to recover from startup infeasibility.

**Derivation:**

| Parent Rule | Relationship |
|-------------|--------------|
| LAW-AUTHORITY-HIERARCHY | Clock authority is absolute; startup overhead does not suspend the clock |
| INV-SCHED-PLAN-BEFORE-EXEC-001 | Feasibility is determined at planning time; schedule content must be feasible by construction |
| INV-CONTROL-NO-POLL-001 | No retry or poll semantics; if first boundary cannot be honored, there is no recovery |
| INV-SWITCH-DEADLINE-AUTHORITATIVE-001 | Switch executes at declared time; startup delay does not shift the boundary |

Root Cause Being Addressed:
When INV-SCHED-PLAN-BEFORE-EXEC-001 is correctly enforced, runtime cannot compensate for infeasible boundaries. If the first boundary is infeasible due to startup latency, the channel will FATAL at runtime—correctly, per contract. This invariant makes the constraint explicit at the schedule/plan level, allowing planning to fail early rather than at runtime.

Implementation:

1. Define startup latency bound as a declared constant:
   ```python
   # Bounded upper limit on channel launch overhead
   # Includes: AIR spawn, ChannelManager init, gRPC establishment, protocol handshake
   STARTUP_LATENCY = timedelta(seconds=2)  # Declared bound, not measured
   ```

2. Validate first boundary at schedule/plan creation:
   ```python
   def validate_startup_feasibility(
       self,
       first_boundary: datetime,
       station_utc: datetime
   ) -> None:
       """Validate first boundary satisfies startup feasibility constraint."""
       required_time = station_utc + STARTUP_LATENCY + MIN_PREFEED_LEAD_TIME

       if first_boundary < required_time:
           raise SchedulingError(
               f"INV-STARTUP-BOUNDARY-FEASIBILITY-001 FATAL: "
               f"First boundary at {first_boundary} is infeasible for startup at {station_utc} "
               f"(required >= {required_time})"
           )
   ```

3. Mock schedule generator MUST respect startup constraint:
   ```python
   # When creating mock A/B schedule:
   # First boundary must be >= station_utc + STARTUP_LATENCY + MIN_PREFEED_LEAD_TIME
   first_feasible = station_utc + STARTUP_LATENCY + MIN_PREFEED_LEAD_TIME
   # Align to next segment boundary after first_feasible
   ```

Constraints:
- `startup_latency` is a bounded, declared upper limit—not a runtime measurement
- `planning_time` (station_utc) MUST NOT be offset to satisfy this constraint
- First boundary MUST be feasible by construction in schedule content
- If no feasible first boundary exists, planning fails FATAL
- Runtime MUST NOT discover, compensate for, or recover from startup infeasibility
- Mock and test schedules are subject to the same constraint as production schedules

Non-Goals (Explicitly Forbidden):
- Offsetting `planning_time` to absorb startup latency
- Adding margin to `planning_time` calculations
- Delaying, padding, or adjusting the first boundary at runtime
- Retry or re-planning after startup begins
- Tick-based discovery of startup infeasibility
- "Soft" failures that allow degraded startup

Anti-Patterns (FORBIDDEN):
```python
# WRONG: Offsetting planning_time to hide startup latency
planning_time = station_utc + startup_margin  # VIOLATION: planning_time must equal station_utc
```

```python
# WRONG: Runtime compensation for startup delay
if time_until_first_boundary < MIN_LEAD_TIME:
    skip_first_boundary()  # VIOLATION: INV-SCHED-PLAN-BEFORE-EXEC-001
```

```python
# WRONG: Adjusting first boundary after planning
first_boundary.time += startup_overhead  # VIOLATION: boundaries must not be adjusted
```

```python
# WRONG: Allowing channel to start with known infeasible first boundary
if not first_boundary_feasible:
    logger.warning("will skip first boundary")  # VIOLATION: must FATAL, not warn
    start_channel_anyway()
```

Correct Pattern:
```python
# RIGHT: Schedule content validation at planning time
def create_schedule(self, station_utc: datetime) -> Schedule:
    first_boundary = self._calculate_first_boundary(station_utc)
    required_time = station_utc + STARTUP_LATENCY + MIN_PREFEED_LEAD_TIME

    if first_boundary < required_time:
        raise SchedulingError("INV-STARTUP-BOUNDARY-FEASIBILITY-001 FATAL: ...")

    # Schedule content is valid; proceed
    return schedule
```

Done Criteria:
- STARTUP_LATENCY defined as bounded, declared constant (not runtime measurement)
- First boundary validated at schedule/plan creation time
- Planning fails FATAL if no feasible first boundary exists
- No planning_time offsets anywhere in codebase
- Mock schedule generator respects startup feasibility constraint
- Happy path test (P11D-006) passes: first boundary executes as scheduled

---
**Done:** STARTUP_LATENCY = timedelta(seconds=7) in channel_manager.py (bounded, declared). At channel launch, first boundary computed with min_lead_timedelta=STARTUP_LATENCY + MIN_PREFEED_LEAD_TIME via _first_feasible_boundary(..., min_lead_timedelta=startup_min_lead). Validation after setting _segment_end_time_utc: if first boundary < station_utc + STARTUP_LATENCY + MIN_PREFEED_LEAD_TIME, raise SchedulingError (INV-STARTUP-BOUNDARY-FEASIBILITY-001 FATAL). Mock A/B has no end_time_utc; channel_manager computes first boundary at launch with startup feasibility. No planning_time offset.

**Validation:** `./scripts/core/run_p11d006_real_assets.sh` passes; first and subsequent boundaries execute as scheduled; stream delivers bytes and TS sync.
