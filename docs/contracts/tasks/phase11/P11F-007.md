Task ID: P11F-007
Rule ID: INV-BOUNDARY-LIFECYCLE-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: ChannelManager
Task Type: TEST
File(s) to Modify: pkg/core/tests/test_channel_manager_boundary_lifecycle.py
Owner: Core
Blocked By: P11F-003, P11F-004

Instructions:
- Add contract tests for boundary state transitions
- Verify all allowed transitions succeed
- Verify illegal transitions force FAILED_TERMINAL
- Verify FAILED_TERMINAL is absorbing

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition (INV-BOUNDARY-LIFECYCLE-001):
Boundary state transitions MUST be unidirectional and follow the defined state machine. Illegal transitions force immediate transition to FAILED_TERMINAL.

Test Cases:

1. Test allowed transitions (happy path):
   ```python
   @pytest.mark.parametrize("from_state,to_state", [
       (BoundaryState.NONE, BoundaryState.PLANNED),
       (BoundaryState.PLANNED, BoundaryState.PRELOAD_ISSUED),
       (BoundaryState.PRELOAD_ISSUED, BoundaryState.SWITCH_SCHEDULED),
       (BoundaryState.SWITCH_SCHEDULED, BoundaryState.SWITCH_ISSUED),
       (BoundaryState.SWITCH_ISSUED, BoundaryState.LIVE),
       (BoundaryState.LIVE, BoundaryState.NONE),
       (BoundaryState.LIVE, BoundaryState.PLANNED),
   ])
   def test_allowed_transitions_succeed(self, from_state, to_state):
       """INV-BOUNDARY-LIFECYCLE-001: Allowed transitions complete normally."""
       manager = self._create_manager_in_state(from_state)
       manager._transition_boundary_state(to_state)
       assert manager._boundary_state == to_state
   ```

2. Test allowed failure transitions:
   ```python
   @pytest.mark.parametrize("from_state", [
       BoundaryState.PLANNED,
       BoundaryState.PRELOAD_ISSUED,
       BoundaryState.SWITCH_SCHEDULED,
       BoundaryState.SWITCH_ISSUED,
   ])
   def test_failure_transitions_allowed(self, from_state):
       """INV-BOUNDARY-LIFECYCLE-001: Any active state can transition to FAILED_TERMINAL."""
       manager = self._create_manager_in_state(from_state)
       manager._transition_boundary_state(BoundaryState.FAILED_TERMINAL)
       assert manager._boundary_state == BoundaryState.FAILED_TERMINAL
   ```

3. Test illegal transitions force FAILED_TERMINAL:
   ```python
   @pytest.mark.parametrize("from_state,to_state", [
       (BoundaryState.NONE, BoundaryState.SWITCH_ISSUED),  # Skip ahead
       (BoundaryState.PLANNED, BoundaryState.LIVE),        # Skip ahead
       (BoundaryState.SWITCH_ISSUED, BoundaryState.PLANNED),  # Go backward
       (BoundaryState.LIVE, BoundaryState.SWITCH_ISSUED),  # Go backward
   ])
   def test_illegal_transitions_force_terminal(self, from_state, to_state):
       """INV-BOUNDARY-LIFECYCLE-001: Illegal transitions force FAILED_TERMINAL."""
       manager = self._create_manager_in_state(from_state)
       manager._transition_boundary_state(to_state)
       assert manager._boundary_state == BoundaryState.FAILED_TERMINAL
       assert manager._pending_fatal is not None
   ```

4. Test FAILED_TERMINAL is absorbing:
   ```python
   @pytest.mark.parametrize("to_state", list(BoundaryState))
   def test_terminal_is_absorbing(self, to_state):
       """INV-BOUNDARY-LIFECYCLE-001: FAILED_TERMINAL allows no transitions."""
       manager = self._create_manager_in_state(BoundaryState.FAILED_TERMINAL)
       manager._transition_boundary_state(to_state)
       assert manager._boundary_state == BoundaryState.FAILED_TERMINAL
   ```

5. Test LIVE is NOT absorbing:
   ```python
   def test_live_allows_next_boundary(self):
       """INV-BOUNDARY-LIFECYCLE-001: LIVE allows transition to NONE or PLANNED."""
       manager = self._create_manager_in_state(BoundaryState.LIVE)

       # Can go to NONE
       manager._transition_boundary_state(BoundaryState.NONE)
       assert manager._boundary_state == BoundaryState.NONE

       # Reset to LIVE
       manager._boundary_state = BoundaryState.LIVE

       # Can go directly to PLANNED (next boundary)
       manager._transition_boundary_state(BoundaryState.PLANNED)
       assert manager._boundary_state == BoundaryState.PLANNED
   ```

Done Criteria:
All allowed transitions tested; all illegal transitions verified to force FAILED_TERMINAL; FAILED_TERMINAL absorbing property verified; LIVE non-absorbing property verified.

---

## Completion Status

| Field | Value |
|-------|-------|
| **Status** | COMPLETE |
| **Completed** | 2026-02-02 |
| **Implementation** | pkg/core/tests/runtime/test_channel_manager_boundary_lifecycle.py: test_allowed_transitions_succeed (parametrized), test_failure_transitions_allowed, test_illegal_transitions_force_terminal, test_terminal_is_absorbing, test_live_allows_next_boundary. Helper _create_manager_in_state(from_state). |
| **Tests** | 23 tests in test_channel_manager_boundary_lifecycle.py; 71 runtime tests pass. |
