Task ID: P11B-003
Rule ID: INV-BOUNDARY-TOLERANCE-001
Subsystem: PlayoutEngine, MetricsExporter
Task Type: METRIC
File(s) to Modify: pkg/air/src/runtime/PlayoutEngine.cpp, pkg/air/src/metrics/MetricsExporter.cpp
Owner: AIR
Blocked By: P11B-001

Instructions:
- Add histogram metric for switch boundary timing delta
- Metric enables analysis of timing distribution

---

Rule Definition:
Grid boundary transitions MUST complete within one video frame duration (33.33ms at 30fps) of the absolute scheduled boundary time.

Metric Specification:

Name: `retrovue_switch_boundary_delta_ms`
Type: Histogram
Labels: `channel_id`
Buckets: [0, 10, 20, 33, 50, 100, 200, 500, 1000, 5000]  // ms

Description: Time delta between scheduled boundary and actual switch completion.

Implementation:
```cpp
// In PlayoutEngine::legacy switch RPC() after switch completes:
int64_t delta_ms = completion_time_ms - target_boundary_time_ms;
metrics_exporter_->RecordSwitchBoundaryDelta(channel_id, delta_ms);
```

Prometheus Output Example:
```
retrovue_switch_boundary_delta_ms_bucket{channel_id="1",le="33"} 45
retrovue_switch_boundary_delta_ms_bucket{channel_id="1",le="50"} 48
retrovue_switch_boundary_delta_ms_bucket{channel_id="1",le="+Inf"} 50
retrovue_switch_boundary_delta_ms_sum{channel_id="1"} 1234
retrovue_switch_boundary_delta_ms_count{channel_id="1"} 50
```

Constraints:
- Use existing metrics infrastructure
- Histogram enables percentile analysis (p50, p95, p99)
- Include 33ms bucket explicitly (1-frame threshold)

Done Criteria:
Histogram metric exposed at /metrics showing switch boundary timing distribution.

---

Completion (2026-02-01): MetricsExporter.RecordSwitchBoundaryDelta(); retrovue_switch_boundary_delta_ms histogram in GenerateMetricsText.
