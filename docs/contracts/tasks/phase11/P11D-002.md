Task ID: P11D-002
Rule ID: INV-SWITCH-DEADLINE-AUTHORITATIVE-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: PlayoutEngine
Task Type: FIX
File(s) to Modify: pkg/air/src/runtime/PlayoutEngine.cpp
Owner: AIR
Blocked By: P11D-001

Instructions:
- Execute switch at deadline even if readiness not achieved
- Remove readiness as blocking condition for switch execution
- **This is the core implementation of "clock supersedes frame completion"**

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.
> Frame completion (INV-FRAME-001, INV-FRAME-003) does NOT gate switch execution.

Rule Definition (INV-SWITCH-DEADLINE-AUTHORITATIVE-001):
When `target_boundary_time_ms` is provided, AIR MUST execute the switch at that wall-clock time ± 1 frame; internal readiness is AIR's responsibility.

Implementation:

1. In ExecuteScheduledSwitch, remove readiness gate:
   ```cpp
   void ExecuteScheduledSwitch(int64_t channel_id) {
       auto now = MasterClock::Now();
       bool was_ready = IsPreviewReady(channel_id);

       LOG_INFO("[PlayoutEngine] INV-SWITCH-DEADLINE-AUTHORITATIVE-001: Executing switch at %ld, readiness=%s",
                now.ToEpochMs(), was_ready ? "true" : "false");

       // Execute switch regardless of readiness state
       // Readiness is now diagnostic, not blocking
       DoSwitch(channel_id);
   }
   ```

2. Change readiness check from gate to diagnostic:
   ```cpp
   // OLD (blocking):
   if (!IsPreviewReady(channel_id)) {
       return SwitchStatus::NOT_READY;
   }
   DoSwitch(channel_id);

   // NEW (non-blocking):
   bool ready = IsPreviewReady(channel_id);
   if (!ready) {
       LOG_WARN("[PlayoutEngine] INV-SWITCH-DEADLINE-AUTHORITATIVE-001: Switch executing with readiness=false");
   }
   DoSwitch(channel_id);  // Always execute
   ```

3. Update switch state machine:
   - Remove WAITING_FOR_READY state if present
   - Transition directly: SCHEDULED → EXECUTING → COMPLETED

Semantic Change:
- OLD: "Switch when ready" — readiness is completion condition
- NEW: "Switch at deadline" — readiness is AIR's internal concern

Constraints:
- Readiness check result MUST still be logged (diagnostic value)
- If not ready, P11D-003 handles safety rails
- Feature flag for rollback (default: disabled until all P11D tasks complete)

Done Criteria:
Switch executes at scheduled deadline regardless of IsPreviewReady() result.

---
**Done:** Implemented in ExecuteSwitchAtDeadline(): computes `ready` state but proceeds regardless. If !ready, logs "INV-SWITCH-DEADLINE-AUTHORITATIVE-001 VIOLATION" and engages safety rails. Switch always executes at deadline.
