Task ID: P11D-001
Rule ID: INV-SWITCH-DEADLINE-AUTHORITATIVE-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: PlayoutEngine
Task Type: FIX
File(s) to Modify: pkg/air/src/runtime/PlayoutEngine.cpp
Owner: AIR
Blocked By: P11C-003

Instructions:
- Schedule switch execution for target_boundary_time_ms via MasterClock
- Switch occurs AT the declared time, not when ready
- **Clock decides WHEN; frame completion does not gate execution**

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition (INV-SWITCH-DEADLINE-AUTHORITATIVE-001):
When `target_boundary_time_ms` is provided, AIR MUST execute the switch at that wall-clock time Â± 1 frame; internal readiness is AIR's responsibility.

Implementation:

1. When SwitchToLive received with target > 0:
   ```cpp
   if (target_boundary_time_ms > 0) {
       // Schedule switch for target time
       auto target_time = MasterClock::FromEpochMs(target_boundary_time_ms);
       switch_scheduler_.ScheduleAt(target_time, [this, channel_id]() {
           ExecuteScheduledSwitch(channel_id);
       });
       LOG_INFO("[PlayoutEngine] INV-SWITCH-DEADLINE-AUTHORITATIVE-001: Switch scheduled for %ld",
                target_boundary_time_ms);
   } else {
       // Legacy mode: execute immediately
       ExecuteImmediateSwitch(channel_id);
   }
   ```

2. ExecuteScheduledSwitch fires at the deadline:
   ```cpp
   void ExecuteScheduledSwitch(int64_t channel_id) {
       auto now = MasterClock::Now();
       LOG_INFO("[PlayoutEngine] INV-SWITCH-DEADLINE-AUTHORITATIVE-001: Executing scheduled switch at %ld",
                now.ToEpochMs());
       // Execute switch regardless of readiness state
       DoSwitch(channel_id);
   }
   ```

3. MasterClock scheduler integration:
   - Use existing timer/callback mechanism
   - Ensure sub-frame timing precision

Constraints:
- Switch MUST fire at target time regardless of buffer state
- Readiness checks become diagnostic, not blocking
- Feature flag for rollback (default: disabled until P11D-002+)

Done Criteria:
Switch executes at declared target time, not when readiness conditions are met.
