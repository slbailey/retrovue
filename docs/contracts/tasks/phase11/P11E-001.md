Task ID: P11E-001
Rule ID: INV-CONTROL-NO-POLL-001
Subsystem: ChannelManager
Task Type: FIX
File(s) to Modify: pkg/core/retrovue/runtime/constants.py (new file), pkg/core/retrovue/runtime/channel_manager.py
Owner: Core
Blocked By: —

Instructions:
- Define MIN_PREFEED_LEAD_TIME_MS constant
- Document the rationale for the value
- Make configurable via environment variable for tuning

---

Rule Definition:
Core MUST issue LoadPreview with sufficient lead time that AIR can achieve readiness before the declared boundary time.

Implementation:

1. Create constants module:
   ```python
   # pkg/core/retrovue/runtime/constants.py

   import os
   from datetime import timedelta

   # Minimum time between LoadPreview and target boundary
   # This must be sufficient for AIR to:
   # 1. Receive the LoadPreview request
   # 2. Seek to the correct position in source media
   # 3. Decode initial frames
   # 4. Buffer MIN_BUFFER_DEPTH frames
   # 5. Signal readiness
   #
   # Default: 5000ms (5 seconds)
   # Can be overridden via RETROVUE_MIN_PREFEED_LEAD_TIME_MS env var
   DEFAULT_MIN_PREFEED_LEAD_TIME_MS = 5000

   MIN_PREFEED_LEAD_TIME_MS = int(
       os.environ.get('RETROVUE_MIN_PREFEED_LEAD_TIME_MS', DEFAULT_MIN_PREFEED_LEAD_TIME_MS)
   )

   MIN_PREFEED_LEAD_TIME = timedelta(milliseconds=MIN_PREFEED_LEAD_TIME_MS)

   # Validation
   if MIN_PREFEED_LEAD_TIME_MS < 1000:
       raise ValueError(
           f"MIN_PREFEED_LEAD_TIME_MS ({MIN_PREFEED_LEAD_TIME_MS}) is dangerously low. "
           "Minimum recommended value is 1000ms."
       )

   if MIN_PREFEED_LEAD_TIME_MS > 30000:
       import logging
       logging.warning(
           f"MIN_PREFEED_LEAD_TIME_MS ({MIN_PREFEED_LEAD_TIME_MS}) is unusually high. "
           "This may cause unnecessary schedule lookahead."
       )
   ```

2. Import in channel_manager:
   ```python
   from retrovue.runtime.constants import MIN_PREFEED_LEAD_TIME, MIN_PREFEED_LEAD_TIME_MS
   ```

3. Document in config:
   ```yaml
   # config/defaults.yaml
   runtime:
     # Minimum lead time (ms) between LoadPreview and switch boundary
     # AIR needs this time to buffer content before switch
     # See INV-CONTROL-NO-POLL-001
     min_prefeed_lead_time_ms: 5000
   ```

Rationale for 5000ms default:
- Network latency (gRPC round trip): ~50ms
- Seek to position: ~200ms (varies by media)
- Initial decode: ~500ms (depends on codec/keyframe distance)
- Buffer fill (90 frames at 30fps = 3000ms): ~3000ms
- Safety margin: ~1250ms
- Total: ~5000ms

Constraints:
- Value must be ≥1000ms (hard minimum)
- Value should be ≤30000ms (practical maximum)
- Must be configurable for different deployment scenarios
- Log the configured value at startup

Done Criteria:
MIN_PREFEED_LEAD_TIME_MS constant defined and documented; value logged at startup.

---
**Done:** `pkg/core/src/retrovue/runtime/constants.py` defines `MIN_PREFEED_LEAD_TIME_MS = 5000` (env override `RETROVUE_MIN_PREFEED_LEAD_TIME_MS`), validates range [1000, 30000], logs at module load via `log_prefeed_constants()`. `STARTUP_LATENCY = timedelta(seconds=7)` also defined for P11D-010.
