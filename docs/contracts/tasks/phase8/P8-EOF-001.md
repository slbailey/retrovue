Task ID: P8-EOF-001
Rule ID: INV-P8-SEGMENT-EOF-DISTINCT-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: AIR (FileProducer, PlayoutEngine)
Task Type: CORE
File(s) to Modify: pkg/air/src/playout/file_producer.cpp, pkg/air/src/playout/playout_engine.cpp, pkg/air/include/playout/playout_engine.h
Owner: AIR
Blocked By: P8-PLAN-002

Instructions:
- Add EOF signaling from FileProducer to PlayoutEngine
- Signal includes segment ID, CT at EOF, frames delivered
- PlayoutEngine receives signal but does NOT advance boundary
- Log DECODER_EOF event

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition (INV-P8-SEGMENT-EOF-DISTINCT-001):
Segment EOF (decoder exhaustion) is distinct from segment end (scheduled boundary). EOF is an event within the segment; boundary is the scheduled instant. Timeline advancement is driven by scheduled segment end time, not by EOF.

Implementation Notes:

1. Add callback interface in PlayoutEngine:
   ```cpp
   void OnLiveProducerEOF(const std::string& segment_id, int64_t ct_at_eof, int64_t frames_delivered);
   ```

2. In FileProducer, on decoder EOF:
   ```cpp
   int64_t ct_at_eof = _timeline_controller->GetCurrentCT();
   LOG_INFO("DECODER_EOF segment={} ct={} frames_delivered={}",
            _segment_id, ct_at_eof, _frames_delivered);
   _engine->OnLiveProducerEOF(_segment_id, ct_at_eof, _frames_delivered);
   _eof_signaled = true;
   ```

3. Add `_eof_signaled` bool to prevent duplicate signals

4. EOF signal triggers content deficit detection (P8-FILL-001)

Observable Proof:
- Log: `DECODER_EOF segment={id} ct={ct} frames_delivered={n}`
- EOF signaled exactly once per segment
- PlayoutEngine receives signal

Done Criteria:
EOF signaled from FileProducer to PlayoutEngine; DECODER_EOF logged with CT and frame count; signal is idempotent.

**Done:** 2026-02-02. FileProducer: added LiveProducerEOFCallback, SetLiveProducerEOFCallback, eof_signaled_; on decoder EOF (eof_reached_ block) log DECODER_EOF (segment, ct, frames_delivered, planned) and invoke callback once. PlayoutEngine: OnLiveProducerEOF(channel_id, segment_id, ct_at_eof_us, frames_delivered); callback wired in StartChannel.
