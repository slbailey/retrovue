Task ID: P8-EOF-002
Rule ID: INV-P8-SEGMENT-EOF-DISTINCT-001
Governing Law: LAW-AUTHORITY-HIERARCHY
Subsystem: AIR (PlayoutEngine)
Task Type: CORE
File(s) to Modify: pkg/air/src/playout/playout_engine.cpp
Owner: AIR
Blocked By: P8-EOF-001

Instructions:
- Decouple EOF from boundary evaluation in PlayoutEngine
- EOF signal does NOT advance boundary state
- EOF signal does NOT trigger SwitchToLive
- Boundary remains at scheduled time; EOF is informational

---

Governing Principle (LAW-AUTHORITY-HIERARCHY):
> Clock authority supersedes frame completion for switch execution.

Rule Definition (INV-P8-SEGMENT-EOF-DISTINCT-001):
EOF is an event within the segment; boundary is the scheduled instant at which the switch occurs. Timeline advancement and boundary evaluation are driven by scheduled segment end time, not by EOF.

Implementation Notes:

1. In OnLiveProducerEOF handler:
   ```cpp
   void PlayoutEngine::OnLiveProducerEOF(const std::string& segment_id,
                                          int64_t ct_at_eof,
                                          int64_t frames_delivered) {
       // EOF does NOT advance boundary
       // EOF does NOT trigger switch
       // EOF triggers content deficit detection
       LOG_DEBUG("EOF received for segment {}, boundary remains at scheduled time", segment_id);

       // Check if we need to start content deficit fill
       if (!_switch_executed && ct_at_eof < _target_boundary_ct) {
           StartContentDeficitFill(segment_id, ct_at_eof, _target_boundary_ct);
       }
   }
   ```

2. Ensure no code path exists that advances boundary on EOF

3. Boundary advance remains clock-driven (tick loop checks scheduled time)

4. Anti-pattern: `if (eof) { AdvanceBoundary(); }` â€” REMOVE if present

Observable Proof:
- EOF does not cause boundary state change
- Boundary advance at scheduled time, not EOF time
- Switch occurs at target_boundary_time_utc, not at EOF

Done Criteria:
EOF decoupled from boundary evaluation; EOF does not trigger switch; boundary timing unchanged by EOF.

**Done:** 2026-02-02. OnLiveProducerEOF only logs DECODER_EOF received and "(boundary remains at scheduled time)"; no boundary advance, no switch trigger. Content deficit fill (P8-FILL-001) will use this hook later.
