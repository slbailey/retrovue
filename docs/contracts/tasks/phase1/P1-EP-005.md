Task ID: P1-EP-005
Rule ID: INV-AIR-IDR-BEFORE-OUTPUT
Subsystem: EncoderPipeline
Task Type: VERIFY
File(s) to Modify: (none - verification only)
Test or Log Name: N/A

Instructions:
- This is a VERIFY task - no code changes required
- Review existing test coverage
- Document findings
- Report whether verification passes or fails

---

Rule Definition:
AIR must not emit video packets until an IDR (keyframe) has been produced. The IDR gate resets on segment switch to ensure each segment starts decodable.

Verification Checklist:
1. [ ] Locate existing tests for IDR gate / keyframe gate
2. [ ] Confirm test verifies no packets emitted before first IDR
3. [ ] Confirm test verifies IDR gate RESETS on segment switch
4. [ ] Confirm test verifies first packet after switch is IDR

Files to Review:
- pkg/air/tests/contracts/MpegTSPlayoutSink/MpegTSPlayoutSinkContractTests.cpp
- pkg/air/tests/contracts/OutputSwitching/OutputSwitchingContractTests.cpp
- pkg/air/tests/contracts/Phase84PersistentMpegTsMuxTests.cpp

Expected Evidence:
- Test that starts encoder and verifies first output is IDR
- Test that performs segment switch and verifies:
  - Gate resets (packets held)
  - First packet after switch is IDR
  - Non-IDR packets before IDR are not emitted

Done Criteria:
Confirmed: test covers IDR gate reset on segment switch.

If Verification Fails:
Create follow-up task to add missing test for IDR gate reset on switch.
