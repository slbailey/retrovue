Task ID: P1-MS-007
Rule ID: INV-P9-TS-EMISSION-LIVENESS
Subsystem: MpegTSOutputSink
Task Type: TEST
File(s) to Modify: pkg/air/tests/contracts/Phase9OutputBootstrapTests.cpp
Test or Log Name: TEST_INV_P9_TS_EMISSION_LIVENESS_500ms

Instructions:
- Implement exactly one atomic task
- Modify ONLY the listed file(s)
- Do not refactor
- Do not add logs unless explicitly requested
- Do not change production behavior unless task type = FIX
- Stop immediately after task passes

---

Rule Definition:
First decodable TS packet MUST be emitted within 500ms of PCR-PACE timing initialization.

Test Scenario:
- Given: MpegTSOutputSink with PCR-PACE mode enabled
- When: Sink is attached and PCR timing is initialized
- Then: First TS bytes are written within 500ms
- And: Elapsed time from PCR-PACE init to first bytes <= 500ms

Assertions Required:
1. [ ] Start channel with normal video/audio producer
2. [ ] Attach sink and enable PCR-PACE timing
3. [ ] Record timestamp when PCR-PACE timing initialized
4. [ ] Wait for first TS bytes to be written (with timeout)
5. [ ] Assert elapsed time <= 500ms
6. [ ] Assert bytes_written > 0

Constraints:
- Use existing test harness patterns
- Do not modify MpegTSOutputSink implementation
- Test must fail if first TS takes longer than 500ms
- Use wall clock timing for measurement

Done Criteria:
Test asserts first TS bytes emitted within 500ms of PCR-PACE init; test fails if bytes=0 after 500ms.

---

## Completion

- **Status:** Done
- **Completed:** 2026-02-01
- **Implementation:** `TEST_INV_P9_TS_EMISSION_LIVENESS_500ms` added in `Phase9OutputBootstrapTests.cpp`; uses socketpair + MpegTSOutputSink, feeds video/audio frames, reads until TS sync 0x47; asserts elapsed <= 500ms.
