Task ID: P1-FP-003
Rule ID: INV-P10-AUDIO-VIDEO-GATE
Subsystem: FileProducer
Task Type: LOG
File(s) to Modify: pkg/air/src/producers/file/FileProducer.cpp
Test or Log Name: INV-P10-AUDIO-VIDEO-GATE violation log

Instructions:
- Implement exactly one atomic task
- Modify ONLY the listed file(s)
- Do not refactor
- Do not add tests unless explicitly requested
- Do not change production behavior
- Stop immediately after log is added

---

Rule Definition:
When a segment's video epoch is established, the first audio frame MUST be queued within 100ms. Violation must be logged with diagnostic information.

Log Specification:
When 100ms elapses after video epoch without first audio frame being queued, log a violation.

Log Format:
```
[FileProducer] INV-P10-AUDIO-VIDEO-GATE VIOLATION: No audio after %dms (deadline=100ms), aq=0
```

Log Level: WARNING (invariant violation)

Location:
In the decode loop or audio push path, when elapsed time exceeds 100ms since video epoch and no audio has been queued. May require adding a periodic check.

Required Fields:
- elapsed_ms: time from video epoch set
- aq: audio queue depth (will be 0 in violation case)

Constraints:
- Add exactly one log statement (may need timer/check logic)
- Requires video epoch timestamp from P1-FP-001
- Log only once per segment (use flag to prevent spam)
- Do not modify control flow beyond adding the check
- Use existing logging macros/patterns in the codebase

Done Criteria:
Log `INV-P10-AUDIO-VIDEO-GATE VIOLATION: No audio after {X}ms (deadline=100ms), aq=0` emitted when 100ms deadline exceeded.

---

## Completion

- **Status:** Done
- **Completed:** 2026-02-01
- **Implementation:** Violation check added in video decode path when `first_mt_pts_us_ != 0` and `!audio_ungated_logged_` and elapsed >= 100ms; logged once per segment via `g_p10_av_gate_violation_logged`.
