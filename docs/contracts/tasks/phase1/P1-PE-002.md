Task ID: P1-PE-002
Rule ID: INV-P9-BOOTSTRAP-READY
Subsystem: PlayoutEngine
Task Type: VERIFY
File(s) to Modify: (none - verification only)

Instructions:
- This is a VERIFY task - no code changes required
- Review existing test coverage
- Document findings
- Report whether verification passes or fails

---

Rule Definition:
Readiness for output is defined as: segment commit detected AND buffer contains ≥1 video frame. Deep buffering is NOT required - minimal buffering enables fast startup.

Verification Checklist:
1. [x] Locate test G9_002 in Phase9OutputBootstrapTests.cpp
2. [x] Confirm test verifies readiness requires commit detection
3. [x] Confirm test verifies readiness requires ≥1 video frame
4. [x] Confirm test verifies readiness does NOT require deep buffering (e.g., 10+ frames)
5. [x] Confirm test verifies readiness passes with exactly 1 frame

Files Reviewed:
- pkg/air/tests/contracts/Phase9OutputBootstrapTests.cpp (G9_002_ReadinessSatisfiedAfterCommit)

---

Verification Result: **PASS**

Evidence:

1. **Test location**
   - `G9_002_ReadinessSatisfiedAfterCommit` at lines 128–174 in Phase9OutputBootstrapTests.cpp.

2. **Commit detection**
   - Initial generation captured: `uint64_t initial_gen = timeline_->GetSegmentCommitGeneration();` (line 150).
   - After flush: `uint64_t current_gen = timeline_->GetSegmentCommitGeneration();` (line 160).
   - `commit_detected = (current_gen > initial_gen)` (line 164).
   - `EXPECT_TRUE(commit_detected) << "Commit should be detected (gen advanced)";` (line 167).

3. **≥1 video frame**
   - `size_t video_depth = ring_buffer.Size();` (line 162).
   - `has_video = (video_depth >= 1)` (line 165).
   - `EXPECT_TRUE(has_video) << "Should have ≥1 video frame";` (line 168).

4. **No deep buffering**
   - Readiness formula: `bootstrap_ready = commit_detected && has_video` with `has_video = (video_depth >= 1)`.
   - No assertion on buffer depth ≥ 10 or similar.

5. **Minimal frame count**
   - Flow: shadow decode → flush single cached frame → buffer has one frame. Test asserts `bootstrap_ready` in that state; readiness passes with exactly 1 frame.

Expected Evidence (all present):
- Test named G9_002: `G9_002_ReadinessSatisfiedAfterCommit`.
- Assertion that commit generation advanced: `EXPECT_TRUE(commit_detected)`.
- Assertion that buffer depth ≥ 1: `EXPECT_TRUE(has_video)`.
- Assertion that readiness passes with minimal frames: `EXPECT_TRUE(bootstrap_ready)` with message "INV-P9-BOOTSTRAP-READY: Readiness should pass with commit + ≥1 frame".
- No assertion requiring buffer depth ≥ 10.

Done Criteria:
**Complete:** G9_002 test asserts readiness = commit + ≥1 video frame. No follow-up task required.
