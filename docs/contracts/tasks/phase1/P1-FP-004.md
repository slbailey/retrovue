Task ID: P1-FP-004
Rule ID: INV-P10-AUDIO-VIDEO-GATE
Subsystem: FileProducer
Task Type: TEST
File(s) to Modify: pkg/air/tests/contracts/Phase10PipelineFlowControlTests.cpp
Test or Log Name: TEST_INV_P10_AUDIO_VIDEO_GATE_100ms

Instructions:
- Implement exactly one atomic task
- Modify ONLY the listed file(s)
- Do not refactor
- Do not add logs unless explicitly requested
- Do not change production behavior unless task type = FIX
- Stop immediately after task passes

---

Rule Definition:
When a segment's video epoch is established, the first audio frame MUST be queued within 100ms.

Test Scenario:
- Given: FileProducer decoding a segment with audio and video
- When: Video epoch is set (VIDEO_EPOCH_SET)
- Then: First audio frame is queued within 100ms
- And: aq > 0 within 100ms of video epoch

Assertions Required:
1. [ ] Start producer with asset containing audio and video
2. [ ] Wait for VIDEO_EPOCH_SET event
3. [ ] Record timestamp when video epoch is set
4. [ ] Wait for first audio frame to be queued (with timeout)
5. [ ] Assert elapsed time <= 100ms
6. [ ] Assert audio queue depth > 0

Constraints:
- Use existing test harness patterns
- Do not modify FileProducer implementation
- Test must fail if first audio takes longer than 100ms after video epoch
- Use wall clock timing for measurement
- May need to create or use test file with guaranteed audio

Done Criteria:
Test asserts first audio frame queued within 100ms of VIDEO_EPOCH_SET; test fails if aq=0 after 100ms.

---

## Completion

- **Status:** Done
- **Completed:** 2026-02-01
- **Implementation:** `TEST_INV_P10_AUDIO_VIDEO_GATE_100ms` added in `Phase10PipelineFlowControlTests.cpp`; starts FileProducer with A/V asset, waits for first video frame (proxy for VIDEO_EPOCH_SET), then asserts first audio in buffer within 100ms.
