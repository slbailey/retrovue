# INV-FUTURE-WINDOW-MUTABLE-001 — Scheduling artifacts outside the execution horizon are explicitly mutable

Status: Invariant
Authority Level: Planning
Derived From: `LAW-IMMUTABILITY`, `LAW-CONTENT-AUTHORITY`

## Purpose

`LAW-IMMUTABILITY` governs what may not be changed once published. Without an explicit counterpart defining what may be changed and when, operators have no constitutional basis for making legitimate pre-execution edits — every planning change becomes constitutionally ambiguous.

This invariant closes the immutability model by defining the boundary precisely: artifacts in the flexible future window (outside the locked execution horizon) are not subject to immutability constraints and may be replaced, regenerated, or overridden through normal operator workflows without requiring an override record. Immutability begins at the execution horizon boundary, not before.

See also: `ScheduleHorizonManagementContract_v0.1.md §4 (Lock Windows)`, `INV-PLAYLOG-LOCKED-IMMUTABLE-001`, `INV-SCHEDULEDAY-IMMUTABLE-001`.

## Guarantee

Scheduling artifacts whose coverage window falls entirely outside the locked execution horizon are subject to normal planning operations without override record requirements:

- A ScheduleDay for a future broadcast date (not yet within the locked window) may be force-regenerated by authorized operator action.
- A Playlist derived from a future ScheduleDay may be regenerated when its ScheduleDay is regenerated.
- A PlaylogEvent sequence for a future window (beyond the current execution horizon end) may be replaced when new planning data is produced.

These operations do not require an override record. They are normal planning pipeline operations.

The boundary is defined as: `MasterClock.now() + lock_horizon_depth`. Artifacts whose entire coverage window is beyond this boundary are in the flexible future. Artifacts that overlap the boundary — even partially — are subject to locked-window immutability for the overlapping portion.

## Preconditions

- `lock_horizon_depth` is explicitly declared per channel and injected into HorizonManager at initialization.
- MasterClock is the authoritative time source for boundary evaluation.
- The flexible future window is evaluated at the time of the requested planning operation, not at artifact creation time.

## Observability

Planning operations on future-window artifacts MUST be permitted without rejection. A rejection of a future-window planning operation on immutability grounds is a false positive violation of this invariant — the system is applying locked-window protection beyond its declared scope.

Monitoring: any planning operation that is rejected by an immutability guard MUST log the evaluated window boundary and the artifact's coverage window, so that false positives (rejecting future-window operations) are distinguishable from true violations (rejecting locked-window mutations).

## Deterministic Testability

Using FakeAdvancingClock: set clock to T. Set lock_horizon_depth to 3 hours. Attempt to force-regenerate a ScheduleDay for T+24h (clearly future). Assert the operation succeeds without an override record requirement. Separately, attempt to mutate a PlaylogEvent at T+1h (within locked window). Assert the operation is rejected. The boundary is deterministic from the injected clock and declared lock depth. No real-time waits required.

## Failure Semantics

**Operator fault** if a future-window artifact is rejected by an immutability guard — the system has miscalculated the boundary or applied locked-window constraints to the wrong temporal region. **Planning fault** if a locked-window artifact is permitted to change without an override record.

## Required Tests

- `pkg/core/tests/contracts/test_scheduling_constitution.py` (PLAYLOG-IMMUT-004, SCHED-DAY-REGEN-FUTURE)

## Enforcement Evidence

TODO
